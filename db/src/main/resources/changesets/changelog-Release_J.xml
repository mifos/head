<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

		<changeSet id="MIFOS_5661" author="Lukasz Wyszomirski" context="expansion">
        <sql endDelimiter=";">
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanImportLoans');
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanImportSavings');

            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
            	(1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanImportLoans'),null);
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
            	(1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanImportSavings'),null);

            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
            values(280,196,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanImportLoans'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanImportLoans'));
			insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
            values(281,196,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanImportSavings'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanImportSavings'));
                
            insert into roles_activity(activity_id, role_id) values(280, 1);
            insert into roles_activity(activity_id, role_id) values(281, 1);
        </sql>
        <rollback>
            <sql endDelimiter=";">
                delete from roles_activity where activity_id = 280;
                delete from roles_activity where activity_id = 281;

                delete from activity where activity_id = 280;
                delete from activity where activity_id = 281;

                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanImportLoans');
                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanImportSavings');

                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanImportLoans';
                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanImportSavings';
            </sql>
        </rollback>
    </changeSet>
		<changeSet id="MIFOS-5671_1" author="Adrian Winkler" context="expansion">
			<sql endDelimiter=";">
			INSERT INTO lookup_value VALUES(DEFAULT, 87, 'Permissions-LoanTransactions-CanMakePaymentToAccountUsingSavingsTransfer');

			INSERT INTO lookup_value_locale(locale_id, lookup_id, lookup_value) SELECT 1, lookup_id, 
			'Can make payment to the account using Savings Account Transfer' FROM lookup_value 
			WHERE lookup_name = 'Permissions-LoanTransactions-CanMakePaymentToAccountUsingSavingsTransfer';

			INSERT INTO activity(activity_id, parent_id, activity_name_lookup_id, description_lookup_id) SELECT 282, 113, lookup_id, lookup_id 
			FROM lookup_value WHERE lookup_name = 'Permissions-LoanTransactions-CanMakePaymentToAccountUsingSavingsTransfer';

			INSERT INTO roles_activity(activity_id, role_id) SELECT activity_id, 1 FROM activity WHERE activity_name_lookup_id = 
			(SELECT lookup_id FROM lookup_value WHERE lookup_name = 'Permissions-LoanTransactions-CanMakePaymentToAccountUsingSavingsTransfer');
			</sql>
			<rollback>
				<sql endDelimiter=";">
				DELETE FROM roles_activity WHERE activity_id = 282;
	    		
	    		DELETE FROM activity WHERE activity_id = 282; 
	    		
	    		DELETE FROM lookup_value_locale WHERE lookup_value = 'Can make payment to the account using Savings Account Transfer';
	    		
	    		DELETE FROM lookup_value WHERE lookup_name = 'Permissions-LoanTransactions-CanMakePaymentToAccountUsingSavingsTransfer';
				</sql></rollback>
		</changeSet>
	<changeSet id="MIFOS-5616_1" author="Michal Dudzinski" context="expansion">
	   	<sql endDelimiter=";">
	    	DROP TABLE IF EXISTS admin_document_acc_action_mix;
	    	CREATE TABLE admin_document_acc_action_mix (
			  admin_doc_acc_action_mix_id integer auto_increment,
			  account_action_id smallint not null,
			  admin_document_id integer not null,
			  created_by smallint,
			  create_date date,
			  updated_by smallint,
			  updated_date date,
			  version_no integer,
			  PRIMARY KEY (admin_doc_acc_action_mix_id),
			  foreign key (account_action_id)
			    references account_action(account_action_id)
			    on delete no action
			    on update no action,
			  foreign key (admin_document_id)
			    references admin_document(admin_document_id)
			    on delete no action
			    on update no action
			)
	   	</sql>
	   	<rollback>
	   		<sql endDelimiter=";">
	   			DROP TABLE admin_document_acc_action_mix;
	   		</sql>
	   	</rollback>
    </changeSet>
    <changeSet id="MIFOS_5723_1" author="Lukasz Wyszomirski" context="expansion">
        <validCheckSum>3:30ae39ddcd8d1df1fb7d13e597f3fbda</validCheckSum>
    	<validCheckSum>3:ab20c7fb0c7f65a28d8430cf5c71c095</validCheckSum>
	    <sql endDelimiter=";">
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewBalanceOutstanding');

            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
            	(1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewBalanceOutstanding'),null);
                
			insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
            values(283,256,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewBalanceOutstanding'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewBalanceOutstanding'));
                
            insert into roles_activity(activity_id, role_id) values(283, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
            values((select max(rid.report_id)+1 from report rid), (select rci.report_category_id from report_category rci where rci.report_category_value='Operational'), 'Balance Outstanding', 'balance_outstanding', 283, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
            values((select report_id from report where report_name='Balance Outstanding'), 'Balance Outstanding', 'balance_outstanding', 'BalanceOutstanding.prpt');
            
          
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewBalanceOutstandingBySourceOfFunds');

            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
            	(1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewBalanceOutstandingBySourceOfFunds'),null);
                
			insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
            values(284,256,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewBalanceOutstandingBySourceOfFunds'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewBalanceOutstandingBySourceOfFunds'));
                
            insert into roles_activity(activity_id, role_id) values(284, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
            values((select max(rid.report_id)+1 from report rid), (select rci.report_category_id from report_category rci where rci.report_category_value='Operational'), 'Balance Outstanding By Source Of Funds', 'balance_outstanding_by_source_of_funds', 284, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
            values((select report_id from report where report_name='Balance Outstanding By Source Of Funds'), 'Balance Outstanding By Source Of Funds', 
            'balance_outstanding_by_source_of_funds', 'BalanceOutstandingBySourceOfFunds.prpt');
            
    
      		insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewDueVsCollectedBranch');

            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
            	(1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewDueVsCollectedBranch'),null);
                
			insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
            values(285,256,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewDueVsCollectedBranch'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewDueVsCollectedBranch'));
                
            insert into roles_activity(activity_id, role_id) values(285, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
            values((select max(rid.report_id)+1 from report rid), (select rci.report_category_id from report_category rci where rci.report_category_value='Operational'), 'Due Vs Collected Branch', 'due_vs_collected_branch', 285, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
            values((select report_id from report where report_name='Due Vs Collected Branch'), 'Due Vs Collected Branch', 
            'due_vs_collected_branch', 'DueVsCollectedBranch.prpt');
            
      
      		insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewDueVsCollectedCenter');

            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
            	(1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewDueVsCollectedCenter'),null);
                
			insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
            values(286,256,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewDueVsCollectedCenter'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewDueVsCollectedCenter'));
                
            insert into roles_activity(activity_id, role_id) values(286, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
            values((select max(rid.report_id)+1 from report rid), (select rci.report_category_id from report_category rci where rci.report_category_value='Operational'), 'Due Vs Collected Center', 'due_vs_collected_center', 286, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
            values((select report_id from report where report_name='Due Vs Collected Center'), 'Due Vs Collected Center', 
            'due_vs_collected_center', 'DueVsCollectedCenter.prpt');
            
       
       		insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewDueVsCollectedOfficer');

            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
            	(1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewDueVsCollectedOfficer'),null);
                
			insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
            values(287,256,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewDueVsCollectedOfficer'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewDueVsCollectedOfficer'));
                
            insert into roles_activity(activity_id, role_id) values(287, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
            values((select max(rid.report_id)+1 from report rid), (select rci.report_category_id from report_category rci where rci.report_category_value='Operational'), 'Due Vs Collected Officer', 'due_vs_collected_officer', 287, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
            values((select report_id from report where report_name='Due Vs Collected Officer'), 'Due Vs Collected Officer',
            'due_vs_collected_officer', 'DueVsCollectedLoanOfficer.prpt');
              
        
       		insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewFundsMovement');

            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
            	(1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewFundsMovement'),null);
                
			insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
            values(288,255,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewFundsMovement'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewFundsMovement'));
                
            insert into roles_activity(activity_id, role_id) values(288, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
            values((select max(rid.report_id)+1 from report rid), (select rci.report_category_id from report_category rci where rci.report_category_value='Management'), 'Funds Movement', 'funds_movement', 288, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
            values((select report_id from report where report_name='Funds Movement'), 'Funds Movement', 'funds_movement', 'FundsMovement.prpt');
              
        
       		insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewLoanClassificationProduct');

            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
            	(1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewLoanClassificationProduct'),null);
                
			insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
            values(289,256,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewLoanClassificationProduct'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewLoanClassificationProduct'));
                
            insert into roles_activity(activity_id, role_id) values(289, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
            values((select max(rid.report_id)+1 from report rid), (select rci.report_category_id from report_category rci where rci.report_category_value='Operational'), 'Loan Classification Product', 'loan_classification_product', 289, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
            values((select report_id from report where report_name='Loan Classification Product'), 'Loan Classification Product', 
            'loan_classification_product', 'LoanClassificationProduct.prpt');
              
        
       		insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewLoanOfficerDetailed');

            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
            	(1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewLoanOfficerDetailed'),null);
                
			insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
            values(290,255,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewLoanOfficerDetailed'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewLoanOfficerDetailed'));
                
            insert into roles_activity(activity_id, role_id) values(290, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
            values((select max(rid.report_id)+1 from report rid), (select rci.report_category_id from report_category rci where rci.report_category_value='Operational'), 'Loan Officer Detailed', 'loan_officer_detailed', 290, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
            values((select report_id from report where report_name='Loan Officer Detailed'), 'Loan Officer Detailed', 
            'loan_officer_detailed', 'LoanOfficerDetailed.prpt');
              
       
       		insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewLoanOfficerPerformanceSummaryCumulative');

            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
            	(1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewLoanOfficerPerformanceSummaryCumulative'),null);
                
			insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
            values(291,256,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewLoanOfficerPerformanceSummaryCumulative'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewLoanOfficerPerformanceSummaryCumulative'));
                
            insert into roles_activity(activity_id, role_id) values(291, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
            values((select max(rid.report_id)+1 from report rid), (select rci.report_category_id from report_category rci where rci.report_category_value='Operational'), 'Loan Officer Performance Summary Cumulative', 
            'loan_officer_performance_summary_cumulative', 291, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
            values((select report_id from report where report_name='Loan Officer Performance Summary Cumulative'), 
            'Loan Officer Performance Summary Cumulative', 'loan_officer_performance_summary_cumulative', 'LoanOfficerPerformanceSummaryCumulative.prpt');
              
       
       		insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewLoanOfficerPerformanceSummaryPeriod');

            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
            	(1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewLoanOfficerPerformanceSummaryPeriod'),null);
                
			insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
            values(292,256,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewLoanOfficerPerformanceSummaryPeriod'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewLoanOfficerPerformanceSummaryPeriod'));
                
            insert into roles_activity(activity_id, role_id) values(292, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
            values((select max(rid.report_id)+1 from report rid), (select rci.report_category_id from report_category rci where rci.report_category_value='Operational'), 'Loan Officer Performance Summary Period', 
            'loan_officer_performance_summary_period', 292, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
            values((select report_id from report where report_name='Loan Officer Performance Summary Period'), 'Loan Officer Performance Summary Period', 
            'loan_officer_performance_summary_period', 'LoanOfficerPerformanceSummaryDuringPeriod.prpt');
              

       		insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanViewMFIProgress');

            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
            	(1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewMFIProgress'),null);
                
			insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
            values(293,255,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewMFIProgress'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanViewMFIProgress'));
                
            insert into roles_activity(activity_id, role_id) values(293, 1);
            
            insert into report(report_id, report_category_id, report_name, report_identifier, activity_id, report_active)
            values((select max(rid.report_id)+1 from report rid), (select rci.report_category_id from report_category rci where rci.report_category_value='Management'), 'MFI Progress', 'mfi_progress', 293, 1);
            
            insert into report_jasper_map(report_id, report_name, report_identifier, report_jasper) 
            values((select report_id from report where report_name='MFI Progress'), 'MFI Progress', 'mfi_progress', 'MFIProgress.prpt');
              
       </sql>
	    <rollback>
	    	<sql endDelimiter=";">
	    		delete from report_jasper_map where report_identifier = 'balance_outstanding';
                delete from report_jasper_map where report_identifier = 'balance_outstanding_by_source_of_funds';
                delete from report_jasper_map where report_identifier = 'due_vs_collected_branch';
                delete from report_jasper_map where report_identifier = 'due_vs_collected_center';
                delete from report_jasper_map where report_identifier = 'due_vs_collected_officer';
                delete from report_jasper_map where report_identifier = 'funds_movement';
                delete from report_jasper_map where report_identifier = 'loan_classification_product';
                delete from report_jasper_map where report_identifier = 'loan_officer_detailed';
                delete from report_jasper_map where report_identifier = 'loan_officer_performance_summary_cumulative';
                delete from report_jasper_map where report_identifier = 'loan_officer_performance_summary_period';
                delete from report_jasper_map where report_identifier = 'mfi_progress';
	    	
	    		delete from report where report_identifier = 'balance_outstanding';
                delete from report where report_identifier = 'balance_outstanding_by_source_of_funds';
                delete from report where report_identifier = 'due_vs_collected_branch';
                delete from report where report_identifier = 'due_vs_collected_center';
                delete from report where report_identifier = 'due_vs_collected_officer';
                delete from report where report_identifier = 'funds_movement';
                delete from report where report_identifier = 'loan_classification_product';
                delete from report where report_identifier = 'loan_officer_detailed';
                delete from report where report_identifier = 'loan_officer_performance_summary_cumulative';
                delete from report where report_identifier = 'loan_officer_performance_summary_period';
                delete from report where report_identifier = 'mfi_progress';
                
	    		delete from roles_activity where activity_id = 283;
                delete from roles_activity where activity_id = 284;
				delete from roles_activity where activity_id = 285;
				delete from roles_activity where activity_id = 286;
				delete from roles_activity where activity_id = 287;
				delete from roles_activity where activity_id = 288;
				delete from roles_activity where activity_id = 289;
				delete from roles_activity where activity_id = 290;
				delete from roles_activity where activity_id = 291;
				delete from roles_activity where activity_id = 292;
				delete from roles_activity where activity_id = 293;
				
	
                delete from activity where activity_id = 283;
                delete from activity where activity_id = 284;
                delete from activity where activity_id = 285;
                delete from activity where activity_id = 286;
                delete from activity where activity_id = 287;
                delete from activity where activity_id = 288;
                delete from activity where activity_id = 289;
                delete from activity where activity_id = 290;
                delete from activity where activity_id = 291;
                delete from activity where activity_id = 292;
                delete from activity where activity_id = 293;

                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanViewBalanceOutstanding');
                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanViewBalanceOutstandingBySourceOfFunds');
                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanViewDueVsCollectedBranch');
				delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanViewDueVsCollectedCenter');
				delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanViewDueVsCollectedOfficer');
				delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanViewFundsMovement');
				delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanViewLoanClassificationProduct');
				delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanViewLoanOfficerDetailed');
				delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanViewLoanOfficerPerformanceSummaryCumulative');
                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanViewLoanOfficerPerformanceSummaryPeriod');
                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanViewMFIProgress');
                
                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanViewBalanceOutstanding';
                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanViewBalanceOutstandingBySourceOfFunds';
                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanViewDueVsCollectedBranch';
                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanViewDueVsCollectedCenter';
                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanViewDueVsCollectedOfficer';
                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanViewFundsMovement';
                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanViewLoanClassificationProduct';
                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanViewLoanOfficerDetailed';
                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanViewLoanOfficerPerformanceSummaryCumulative';
                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanViewLoanOfficerPerformanceSummaryPeriod';
                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanViewMFIProgress'; 
	    	</sql>
	    </rollback>
    </changeSet>
    <changeSet id="MIFOS-5716_1" author="Jakub Podeszwik" context="contraction">
      	<sql endDelimiter=";">
	        update  account m
	        inner join loan_account l
	        on m.account_id = l.account_id
	        inner join account p
	        on p.account_id = l.parent_account_id
	        set m.account_state_id = p.account_state_id
	        where m.account_state_id != p.account_state_id;
	   	</sql>
	   	<rollback>
	   	</rollback>
   </changeSet>
   <changeSet id="MIFOS-5733_1" author="Jakub Podeszwik" context="contraction">
       <sql endDelimiter=";">
	       UPDATE loan_schedule ls1
	       INNER JOIN loan_account la
	       ON ls1.account_id = la.account_id
	       INNER JOIN loan_schedule ls2
	       ON ls2.account_id = la.parent_account_id
	       SET ls1.action_date = ls2.action_date
	       WHERE ls1.installment_id = ls2.installment_id;
       </sql>
       <rollback>
       </rollback>
   </changeSet>
   <changeSet id="MIFOS-5632_1" author="Kamil Kalfas" context="expansion">
       <sql endDelimiter=";">
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanEditQuestionGroups');
                
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanEditQuestionGroups'),null); 
                
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(294,203,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanEditQuestionGroups'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanEditQuestionGroups'));
                
            insert into roles_activity(activity_id, role_id) values(294, 1);          
           
            alter table question_group add activity_id smallint,
                add constraint foreign key(activity_id) 
                    references activity(activity_id)
                    on delete no action
                    on update no action;

       </sql>
       <rollback>
           <sql endDelimiter=";">
                alter table question_group drop column activity_id,
                    drop foreign key question_group_ibfk_1;
               
                delete from roles_activity where activity_id = 294 or activity_id in (select activity_id from activity where parent_id = 294);
                
                delete from activity where parent_id = 294 or activity_id = 294;
                
                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanEditQuestionGroups');

                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanEditQuestionGroups';
           </sql>
       </rollback>
   </changeSet>
   <changeSet id="MIFOSACC" author="Hugo Technologies" context="expansion">
		<sql endDelimiter=";">
			Insert into config_key_value
			(configuration_type,configuration_key,
			configuration_value) values
			(1,'MisProcessing','01/01/2012');

			INSERT INTO
			lookup_entity(entity_name, description) VALUES ('Cash', 'Cash
			CoA');
			INSERT INTO lookup_entity(entity_name, description) VALUES ('Bank',
			'Bank
			CoA');

			insert into lookup_value(entity_id,lookup_name) values
			((Select entity_id
			from lookup_entity where
			entity_name='Cash'),'11101');
			insert into
			lookup_value(entity_id,lookup_name) values ((Select entity_id
			from
			lookup_entity where
			entity_name='Cash'),'11102');
			insert into
			lookup_value(entity_id,lookup_name) values ((Select entity_id
			from
			lookup_entity where
			entity_name='Bank'),'11201');
			insert into
			lookup_value(entity_id,lookup_name) values ((Select entity_id
			from
			lookup_entity where
			entity_name='Bank'),'11202');


			create table
			`acc_financialyear` (
			`financialyear_id` int(8) not null,
			`financialyear_startdate` date,
			`financialyear_enddate` date,
			`status`
			varchar(1) default null,
			`created_by` int not null,
			`created_date` date
			not null,
			primary key (`financialyear_id`)
			)
			engine=innodb character set
			utf8;
			insert into acc_financialyear values
			(20122012,'2012-01-01','2012-12-31','A',1,'2012-01-01');


			create table
			`acc_glbalances` (
			`glbalances_id` smallint(6) not null
			auto_increment,
			`financialyear_id` int(8) not null,
			`office_level` int
			not null,
			`office_id` varchar(30) NOT NULL,
			`glcode_value` varchar(50)
			not null,
			`openning_bal` decimal(21,4) not null,
			`transaction_dr_sum`
			decimal(21,4) not null,
			`transaction_cr_sum` decimal(21,4) not null,
			`closing_bal` decimal(21,4) not null,
			`created_by` int not null,
			`created_date` date not null,
			primary key (`glbalances_id`),
			foreign
			key(`financialyear_id`)
			references acc_financialyear(financialyear_id)
			on delete no action
			on update no action
			) engine=innodb character set
			utf8;


			create table acc_glmaster (
			`transaction_master_id` bigint(20)
			not null auto_increment,
			`transaction_date` datetime default null,
			`transaction_type` varchar(64) not null,
			`from_office_level` int not
			null,
			`from_office_id` varchar(30) not null,
			`main_account` varchar(64)
			not null,
			`transaction_amount` decimal(21,3) default null,
			`amount_action` varchar(20),
			`transaction_narration` varchar(255) not
			null,
			`to_office_level` int not null,
			`to_office_id` varchar(30) not
			null,
			`transaction_by` smallint default 0,
			`status` varchar(30) not
			null,
			`created_by` int not null,
			`created_date` date not null,
			primary
			key (`transaction_master_id`)
			)
			engine=innodb character set utf8;

			create table acc_gldetail (
			transaction_master_id bigint(20) default
			null,
			`transaction_id` bigint(20) not null auto_increment,
			`sub_account` varchar(64) not null,
			`transaction_amount` decimal(21,3)
			default null,
			`amount_action` varchar(20),
			`cheque_no` varchar(40),
			`cheque_date` datetime default null,
			`bank_name` varchar(20),
			`bank_branch` varchar(120),
			primary key(transaction_id),
			foreign
			key(transaction_master_id)
			references
			acc_glmaster(transaction_master_id)
			)
			engine=innodb character set utf8;




			insert into lookup_value(lookup_id, entity_id, lookup_name) values
			((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv), 87,
			'Permissions-SingleGeneralledger');
			insert into lookup_value(lookup_id,
			entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87, 'Permissions-JournalVoucher');
			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-CanDefineOpenBalances');
			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-CanViewGlTransactions');
			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-CanProcessAccountingTransactions');







			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-SingleGeneralledger'), NULL);
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-JournalVoucher'), NULL);
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-CanDefineOpenBalances'), NULL);
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-CanViewGlTransactions'), NULL);
			insert into
			lookup_value_locale(locale_id, lookup_id) values
			(1, (select lookup_id
			from lookup_value where
			lookup_name='Permissions-CanProcessAccountingTransactions'));








			insert
			into activity(activity_id, parent_id, activity_name_lookup_id,
			description_lookup_id) values
			(295, 113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-SingleGeneralledger'),
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-SingleGeneralledger'));

			insert into
			activity(activity_id, parent_id, activity_name_lookup_id,
			description_lookup_id) values
			(296, 113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-JournalVoucher'),
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-JournalVoucher'));

			insert into
			activity(activity_id, parent_id, activity_name_lookup_id,
			description_lookup_id) values
			(297, 113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-CanDefineOpenBalances'),
			(select lookup_id
			from lookup_value where entity_id = 87 AND
			lookup_name='Permissions-CanDefineOpenBalances'));

			insert into activity(activity_id, parent_id,
			activity_name_lookup_id,
			description_lookup_id) values
			(298, 113,
			(select lookup_id from lookup_value where entity_id = 87 AND
			lookup_name='Permissions-CanViewGlTransactions'),
			(select lookup_id
			from lookup_value where entity_id = 87 AND
			lookup_name='Permissions-CanViewGlTransactions'));

			insert into activity(activity_id, parent_id,
			activity_name_lookup_id,
			description_lookup_id) values
			(299, 113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-CanProcessAccountingTransactions'),
			(select
			lookup_id from lookup_value where entity_id = 87 AND
			lookup_name='Permissions-CanProcessAccountingTransactions'));





			insert into roles_activity(activity_id, role_id) values (295, 1);
			
			insert into roles_activity(activity_id, role_id) values (296, 1);
			
			insert into roles_activity(activity_id, role_id) values (297, 1);
			
			insert into roles_activity(activity_id, role_id) values (298, 1);
			
			insert into roles_activity(activity_id, role_id) values (299, 1);
			


		</sql>
		<rollback>
			<sql endDelimiter=";">
				Delete from config_key_value where
				configuration_key='MisProcessing' ;

				delete lv from lookup_value as lv
				join lookup_entity as le
				where le.entity_id=lv.entity_id and
				le.entity_name='cash' ;

				delete lv from lookup_value as lv
				join
				lookup_entity as le
				where le.entity_id=lv.entity_id and
				le.entity_name='bank' ;


				DELETE FROM lookup_entity WHERE entity_name LIKE 'Cash';
				
				DELETE FROM lookup_entity WHERE entity_name LIKE 'Bank';


				DROP TABLE IF EXISTS acc_glbalances;
				
				DROP TABLE IF EXISTS acc_financialyear;
				
				DROP TABLE IF EXISTS acc_gldetail;
				
				DROP TABLE IF EXISTS acc_glmaster;
				

				DELETE FROM roles_activity WHERE activity_id =
				295;
				DELETE FROM roles_activity WHERE activity_id = 296;
				DELETE FROM
				roles_activity WHERE activity_id = 297;
				DELETE FROM roles_activity
				WHERE activity_id = 298;
				DELETE FROM roles_activity WHERE activity_id
				= 299;


				delete from activity where activity_id = 295;
				delete from
				activity where activity_id = 296;
				delete from activity where
				activity_id = 297;
				delete from activity where activity_id = 298;
				delete from activity where activity_id = 299;


				DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value
				WHERE lookup_name='Permissions-SingleGeneralledger');
				
				DELETE
				FROM lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value
				WHERE lookup_name='Permissions-JournalVoucher');
				
				DELETE
				FROM lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value
				WHERE lookup_name='Permissions-CanDefineOpenBalances');
				
				DELETE FROM lookup_value_locale WHERE lookup_id =(SELECT lookup_id
				from
				lookup_value
				WHERE
				lookup_name='Permissions-CanViewGlTransactions');
				
				DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value
				WHERE
				lookup_name='Permissions-CanProcessAccountingTransactions');


				DELETE
				FROM lookup_value WHERE entity_id = 87 AND lookup_name =
				'Permissions-SingleGeneralledger';
				
				DELETE FROM lookup_value WHERE entity_id
				= 87 AND lookup_name =
				'Permissions-JournalVoucher';
				
				DELETE FROM
				lookup_value WHERE entity_id = 87 AND lookup_name =
				'Permissions-CanDefineOpenBalances';
				
				DELETE FROM lookup_value WHERE
				entity_id = 87 AND lookup_name =
				'Permissions-CanViewGlTransactions';
				
				DELETE FROM lookup_value WHERE
				entity_id = 87 AND lookup_name
				='Permissions-CanProcessAccountingTransactions';
			</sql>
		</rollback>
	</changeSet>
   <changeSet id="MIFOS_5702_1" author="Kamil Kalfas">
       <sql endDelimiter=";">
            create table trxn_imported_files (
                file_name varchar(100) not null,
                account_trxn_id int(11) not null,
                primary key(file_name, account_trxn_id),
                foreign key(file_name) 
                    references imported_transactions_files(file_name)
						on delete no action
						on update no action,
                foreign key(account_trxn_id) 
                    references account_trxn(account_trxn_id)
						on delete no action
						on update no action
            ) engine=innodb character set utf8;
            
            alter table imported_transactions_files add phase_out boolean default 0;
       </sql>
       <rollback>
           <sql endDelimiter=";">
               alter table imported_transactions_files drop column phase_out;    
               
               drop table trxn_imported_files;
           </sql>
       </rollback>
   </changeSet>
   <changeSet id="MIFOS_5702_2" author="Kamil Kalfas">
       <sql endDelimiter=";">
             alter table imported_transactions_files add undoable boolean default 0;
       </sql>
       <rollback>
           <sql endDelimiter=";">
             alter table imported_transactions_files drop column undoable;
           </sql>
       </rollback>
   </changeSet>
   <changeSet id="MIFOS_RI" author="Hugo Technologies" context="expansion">
        <sql endDelimiter=";">
            Insert into config_key_value(configuration_type,configuration_key, configuration_value) values (0,'RecalculateInterest','0');
        </sql>
        <rollback>
            <sql endDelimiter=";">
                Delete from config_key_value where configuration_key='RecalculateInterest';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="MIFOS_5838_1" author="Jakub Podeszwik">
    	<validCheckSum>3:1c2a19edbf586d09a51c7b904f209fa1</validCheckSum>
    	<validCheckSum>3:c7a441af8081f4f3ec675b6a7a5eb56a</validCheckSum>
       <sql endDelimiter=";">
			drop table if exists temporary_account_ids;
			create table temporary_account_ids (account_id INT(11));
			
			insert into temporary_account_ids (account_id) 
			select a.account_id
			from account a
			inner join (select ls6.account_id, sum(ls6.interest) as interestsum, sum(ls6.principal) as principalsum from loan_schedule ls6 group by ls6.account_id) as ls5
			on a.account_id=ls5.account_id
			inner join loan_summary ls
			on ls.account_id=a.account_id
			where ls.orig_principal-ls5.principalsum > 1
			and a.account_state_id in (5,9);
			
			update loan_schedule as target
			inner join (select lsu1.orig_principal, lsu1.orig_interest, lsu1.account_id from loan_summary lsu1) as ls2
			on target.account_id=ls2.account_id
			inner join (select ls6.account_id, max(ls6.installment_id) as instno, sum(ls6.interest) as interestsum, sum(ls6.principal) as principalsum from loan_schedule ls6 group by ls6.account_id) as ls5
			on target.account_id=ls5.account_id
			set target.interest=target.interest+(ls2.orig_interest-ls5.interestsum),
			target.principal=target.principal+(ls2.orig_principal-ls5.principalsum)
			where target.installment_id=ls5.instno
			and target.account_id in ( select * from temporary_account_ids );
			
			update loan_schedule as target
			inner join temporary_account_ids tai
			on target.account_id = tai.account_id
			set target.principal_paid=target.principal_paid+(target.interest_paid-target.interest),
			target.interest_paid=target.interest
			where target.interest_paid > target.interest;
			
			drop table if exists temporary_account_ids;
       </sql>
       <rollback>
           <sql endDelimiter=";">
             drop table if exists temporary_account_ids;
           </sql>
       </rollback>
   </changeSet>
   <changeSet id="MIFOS-5828_1" author="Lukasz Wyszomirski" context="expansion">
        <sql endDelimiter=";">
        	ALTER TABLE report ADD is_dw boolean default 0; 
        	
        	UPDATE report SET is_dw=1 WHERE report_name='Loan Officer Detailed';
        	UPDATE report SET report_category_id=8 WHERE report_name='Loan Officer Detailed';
        	UPDATE report SET is_dw=1 WHERE report_name='MFI Progress'; 
        	UPDATE report SET is_dw=1 WHERE report_name='Funds Movement'; 
        	UPDATE report SET is_dw=1 WHERE report_name='Due Vs Collected Branch'; 
        	UPDATE report SET is_dw=1 WHERE report_name='Due Vs Collected Center'; 
        	UPDATE report SET is_dw=1 WHERE report_name='Due Vs Collected Officer'; 
        	UPDATE report SET is_dw=1 WHERE report_name='Loan Officer Performance Summary Period'; 
        	UPDATE report SET is_dw=1 WHERE report_name='Loan Officer Performance Summary Cumulative'; 
        	UPDATE report SET is_dw=1 WHERE report_name='Loan Classification Product'; 
        	UPDATE report SET is_dw=1 WHERE report_name='Balance Outstanding By Source Of Funds'; 
        	UPDATE report SET is_dw=1 WHERE report_name='Balance Outstanding'; 
        	
        	UPDATE report SET report_name='Loan Classification by Product' WHERE report_name='Loan Classification Product';
        	UPDATE report SET report_name='Due Vs Collected by Branch'  WHERE report_name='Due Vs Collected Branch'; 
        	UPDATE report SET report_name='Due Vs Collected by Center' WHERE report_name='Due Vs Collected Center'; 
        	UPDATE report SET report_name='Due Vs Collected by Officer' WHERE report_name='Due Vs Collected Officer';
        	UPDATE report SET report_name='Loan Officer Details' WHERE report_name='Loan Officer Detailed';   
        </sql>
        <rollback>
            <sql endDelimiter=";">
            	alter table report drop column is_dw;
            </sql>
        </rollback>
    </changeSet>
   <changeSet id="MIFOS_5628_1" author="Kamil Kalfas">
       <validCheckSum>3:6e67590c7fa9e8af6457ce29d6d7f7ca</validCheckSum>
       <preConditions onFail="MARK_RAN">
           <sqlCheck expectedResult="0">
               select count(*) from account_type where account_type_id = 5;
           </sqlCheck>
       </preConditions>
       <sql endDelimiter=";">
		   INSERT INTO account_type(account_type_id, lookup_id, description) VALUES(5, 126, 'Group Loan Account');
       </sql>
       <rollback>
       </rollback>
   </changeSet>
   <changeSet id="MIFOS_5628_2" author="Kamil Kalfas">
   <validCheckSum>3:cf70722aa160cda0e8e3696e69ddc287</validCheckSum>
       <sql endDelimiter=";">
           ALTER TABLE account_payment ADD parent_payment_id int;
       </sql>
       <rollback>
           <sql endDelimiter=";">
             ALTER TABLE account_payment DROP parent_payment_id;
           </sql>
       </rollback>
   </changeSet>
</databaseChangeLog>
