<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
    <changeSet id="MIFOS-5739" author="Pawel Reise" context="expansion">
        <sql endDelimiter=";">
            create table file_info (
                file_info_id bigint auto_increment not null,
                name varchar(255) not null,
                content_type varchar(255) not null,
                size integer not null,
                description text,
                upload_date datetime not null,
                primary key(file_info_id)
            ) engine=innodb character set utf8;
            create table client_file (
                file_id bigint auto_increment not null,
                client_id integer,
                file_info bigint,
                primary key(file_id),
                foreign key(file_info)
                    references file_info(file_info_id),
                foreign key(client_id)
                    references customer(customer_id)
            ) engine=innodb character set utf8;
        </sql>
        <rollback>
            drop table client_file;
            drop table file_info;
        </rollback>
    </changeSet>
    <changeSet id="MIFOS-5739_2" author="Pawel Reise" context="expansion">
        <sql endDelimiter=";">
            create table loan_file (
                file_id bigint auto_increment not null,
                loan_id integer,
                file_info bigint,
                primary key(file_id),
                foreign key(file_info)
                    references file_info(file_info_id),
                foreign key(loan_id)
                    references account(account_id)
            ) engine=innodb character set utf8;
        </sql>
        <rollback>
            drop table loan_file;
        </rollback>
    </changeSet>

   <changeSet id="MIFOS-5712" author="Wojciech Szarmacher" context="expansion">
       <sql endDelimiter=";">
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Permissions-CanModifyChartOfAccounts');
                
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanModifyChartOfAccounts'),null); 
                
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(307,203,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanModifyChartOfAccounts'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Permissions-CanModifyChartOfAccounts'));
                
            insert into roles_activity(activity_id, role_id) values(307, 1);
       </sql>
       <rollback>
           <sql endDelimiter=";">
                delete from roles_activity where activity_id = 307 or activity_id in (select activity_id from activity where parent_id = 307);
                
                delete from activity where parent_id = 307 or activity_id = 307;
                
                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Permissions-CanModifyChartOfAccounts');

                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Permissions-CanModifyChartOfAccounts';
           </sql>
       </rollback>
   </changeSet>
   <changeSet id="MIFOS-5626" author="Krzysztof Kaczmarczyk" context="expansion">
       <sql endDelimiter=";">
            insert into lookup_value(lookup_id,entity_id,lookup_name) values((select max(lv.lookup_id)+1 from
                lookup_value lv), 87, 'Can unblacklist a Client');
                
            insert into lookup_value_locale(locale_id,lookup_id,lookup_value) values
                (1,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can unblacklist a Client'),null); 
                
            insert into activity(activity_id,parent_id, activity_name_lookup_id, DESCRIPTION_lookup_id) 
                values(301,34,(select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can unblacklist a Client'),
                (select lookup_id from lookup_value where entity_id =87 and
                lookup_name='Can unblacklist a Client'));
                
            insert into roles_activity(activity_id, role_id) values(301, 1);          
       </sql>
       <rollback>
           <sql endDelimiter=";">
                delete from roles_activity where activity_id = 301 or activity_id in (select activity_id from activity where parent_id = 301);
                
                delete from activity where parent_id = 301 or activity_id = 301;
                
                delete from lookup_value_locale where lookup_id =
                    (select lookup_id from lookup_value
                    where lookup_name='Can unblacklist a Client');

                delete from lookup_value where entity_id = 87 and lookup_name =
                    'Can unblacklist a Client';
           </sql>
       </rollback>
   </changeSet>
   <changeSet id="MIFOSFINANACC" author="Hugo Technologies"
		context="expansion">
		<sql endDelimiter=";">

			alter table acc_glmaster add stage INT default
			0;
			alter table acc_gldetail add transaction_narration varchar(100) default
			null;
			create table `coa_branch` (`coa_id` integer not null auto_increment,
            `glcode_value` varchar(50) default null,
            `global_office_num` varchar(50) default null,
             `coa_name` varchar(42) default null,
             PRIMARY KEY (`coa_id`)
               );

			alter table acc_glmaster add updated_date timestamp default
			current_timestamp;

			alter table acc_glmaster add member_id varchar(20)
			default null;

			alter table acc_glmaster add audit varchar(10) default
			'no';

			alter table acc_glmaster add audit_comments varchar(225);

			create table acc_process_update(pud_id smallint(10) PRIMARY KEY AUTO_INCREMENT,branch_globaloffice_num varchar(100),last_update_date date);


			insert
			into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-GeneralLedgerSave');

			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-GeneralLedgerSave'), NULL);


			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(302,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-GeneralLedgerSave'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-GeneralLedgerSave'));


			insert into
			roles_activity(activity_id, role_id) values (302, 1);

			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-JournalVoucherSave');

			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-JournalVoucherSave'), NULL);


			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(303,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-JournalVoucherSave'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-JournalVoucherSave'));


			insert into
			roles_activity(activity_id, role_id) values (303, 1);



			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-ViewStageTransactions');
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-ViewStageTransactions'), NULL);
			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(304,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-ViewStageTransactions'),
			(select
			lookup_id
			from lookup_value where entity_id = 87 AND
			lookup_name='Permissions-ViewStageTransactions'));
			insert into
			roles_activity(activity_id, role_id) values (304, 1);

			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-InterOfficeTransfers');
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-InterOfficeTransfers'), NULL);
			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(305,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-InterOfficeTransfers'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-InterOfficeTransfers'));
			insert into
			roles_activity(activity_id, role_id) values (305, 1);

			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-ApproveTransactions');
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-ApproveTransactions'), NULL);
			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(306,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-ApproveTransactions'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-ApproveTransactions'));
			insert into
			roles_activity(activity_id, role_id) values (306, 1);

			insert into
			lookup_value(lookup_id,entity_id, lookup_name) values ((SELECT
			MAX(lv.lookup_id)+1 FROM
			lookup_value lv),87,
			'Permissions-AuditTransactions');
			insert into
			lookup_value_locale(locale_id, lookup_id, lookup_value) values
			(1,
			(select lookup_id from lookup_value where
			lookup_name='Permissions-AuditTransactions'), NULL);
			insert into
			activity(activity_id,
			parent_id,activity_name_lookup_id,description_lookup_id) values
			(308,
			113,
			(select lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-AuditTransactions'),
			(select
			lookup_id from
			lookup_value where entity_id = 87 AND
			lookup_name='Permissions-AuditTransactions'));
			insert into
			roles_activity(activity_id, role_id) values (308, 1);
			

		</sql>
		<rollback>
			<sql endDelimiter=";">

				DELETE FROM lookup_value WHERE
				entity_id = 87
				AND lookup_name
				='Permissions-CanProcessAccountingTransactions';


				DELETE FROM lookup_value_locale WHERE lookup_id =(SELECT lookup_id
				from
				lookup_value WHERE lookup_name='Permissions-GeneralLedgerSave');

				DELETE FROM roles_activity WHERE activity_id= 302;

				DELETE FROM
				activity WHERE activity_id = 302;

				DELETE FROM lookup_value WHERE
				entity_id = 87 AND lookup_name ='Permissions-GeneralLedgerSave';

				DELETE FROM lookup_value_locale WHERE lookup_id =(SELECT lookup_id
				from
				lookup_value WHERE
				lookup_name='Permissions-JournalVoucherSave');

				DELETE FROM
				roles_activity WHERE activity_id= 303;

				DELETE FROM activity WHERE
				activity_id = 303;

				DELETE FROM lookup_value WHERE entity_id = 87 AND
				lookup_name ='Permissions-JournalVoucherSave';




				DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value WHERE lookup_name='Permissions-ViewStageTransactions');

				DELETE
				FROM roles_activity WHERE activity_id= 304;

				DELETE FROM activity
				WHERE activity_id = 304;

				DELETE FROM lookup_value WHERE entity_id =
				87 AND lookup_name ='Permissions-ViewStageTransactions';

				DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value WHERE lookup_name='Permissions-InterOfficeTransfers');

				DELETE
				FROM roles_activity WHERE activity_id= 305;

				DELETE FROM activity
				WHERE activity_id = 305;

				DELETE FROM lookup_value WHERE entity_id =
				87 AND lookup_name ='Permissions-InterOfficeTransfers';

				DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value WHERE lookup_name='Permissions-ApproveTransactions');

				DELETE
				FROM roles_activity WHERE activity_id= 306;

				DELETE FROM activity
				WHERE activity_id = 306;

				DELETE FROM lookup_value WHERE entity_id =
				87 AND lookup_name ='Permissions-ApproveTransactions';

				DELETE FROM
				lookup_value_locale WHERE lookup_id =(SELECT lookup_id from
				lookup_value WHERE lookup_name='Permissions-AuditTransactions');

				DELETE
				FROM roles_activity WHERE activity_id= 308;

				DELETE FROM activity
				WHERE activity_id = 308;

				DELETE FROM lookup_value WHERE entity_id =
				87 AND lookup_name ='Permissions-AuditTransactions';
				

			</sql>

		</rollback>
	</changeSet>
   
</databaseChangeLog>
