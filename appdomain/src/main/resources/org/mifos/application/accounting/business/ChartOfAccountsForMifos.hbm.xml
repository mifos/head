<?xml version="1.0" encoding='UTF-8'?>
<!DOCTYPE hibernate-mapping PUBLIC
                            "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                            "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd" >
<hibernate-mapping>


	<sql-query name="ChartOfAccountsForMifos.Cash">
		<return-scalar column="glcode" type="string" />
		<return-scalar column="glname" type="string" />
        <![CDATA[
            Select b.glcode_value as glcode,a.coa_name as glname from coa a,gl_code b where a.glcode_id=b.glcode_id
			and glcode_value in (Select lookup_name from lookup_value where entity_id in 
			(Select entity_id from lookup_entity where entity_name='Cash'));

        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.Bank">
		<return-scalar column="glcode" type="string" />
		<return-scalar column="glname" type="string" />
        <![CDATA[
            Select b.glcode_value as glcode,a.coa_name as glname from coa a,gl_code b where a.glcode_id=b.glcode_id
			and glcode_value in (Select lookup_name from lookup_value where entity_id in 
			(Select entity_id from lookup_entity where entity_name='Bank'));

        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.AccountHeadGlCodes">
		<return-scalar column="glcode" type="string" />
		<return-scalar column="glname" type="string" />
        <![CDATA[
         SELECT gll.glcode_value as glcode, coo.coa_name as glname
			FROM coahierarchy c
			      LEFT JOIN coa co ON co.coa_id = c.parent_coaid
			      LEFT JOIN gl_code gl ON gl.glcode_id = co.glcode_id
			      LEFT JOIN coa coo ON coo.coa_id = c.coa_id
			      LEFT JOIN gl_code gll ON gll.glcode_id = coo.glcode_id
     		WHERE c.parent_coaid is not null and gll.glcode_value <> :Gl_Code ;


        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.DebitAccountGlCodes">
		<return-scalar column="glcode" type="string" />
		<return-scalar column="glname" type="string" />
        <![CDATA[
               SELECT gll.glcode_value as glcode, coo.coa_name as glname
			FROM coahierarchy c
			      LEFT JOIN coa co ON co.coa_id = c.parent_coaid
			      LEFT JOIN gl_code gl ON gl.glcode_id = co.glcode_id
			      LEFT JOIN coa coo ON coo.coa_id = c.coa_id
			      LEFT JOIN gl_code gll ON gll.glcode_id = coo.glcode_id
      WHERE c.parent_coaid is not null order by 1;
        ]]>

	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.CreditAccountGlCodes">
		<return-scalar column="glcode" type="string" />
		<return-scalar column="glname" type="string" />
        <![CDATA[
                    SELECT gll.glcode_value as glcode, coo.coa_name as glname
			FROM coahierarchy c
			      LEFT JOIN coa co ON co.coa_id = c.parent_coaid
			      LEFT JOIN gl_code gl ON gl.glcode_id = co.glcode_id
			      LEFT JOIN coa coo ON coo.coa_id = c.coa_id
			      LEFT JOIN gl_code gll ON gll.glcode_id = coo.glcode_id
      WHERE c.parent_coaid is not null and gll.glcode_value <> :Gl_Code order by 1;
        ]]>
	</sql-query>
	
	<sql-query name="ChartOfAccountsForMifos.TotalGlCodes">
		<return-scalar column="glcode" type="string" />
		<return-scalar column="glname" type="string" />
        <![CDATA[
     SELECT gll.glcode_value as glcode, coo.coa_name as glname
			FROM coahierarchy c
			      LEFT JOIN coa co ON co.coa_id = c.parent_coaid
			      LEFT JOIN gl_code gl ON gl.glcode_id = co.glcode_id
			      LEFT JOIN coa coo ON coo.coa_id = c.coa_id
			      LEFT JOIN gl_code gll ON gll.glcode_id = coo.glcode_id
      WHERE c.parent_coaid is not null order by 1;
        ]]>

	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.customer">
		<return-scalar column="globalOfficeNum" type="string" />
		<return-scalar column="displayName" type="string" />
        <![CDATA[
            select c.global_cust_num as globalOfficeNum, c.display_name as displayName
            from customer c
            where c.customer_level_id= :CUSTOMER_LEVEL_ID
        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.office">
		<return-scalar column="globalOfficeNum" type="string" />
		<return-scalar column="displayName" type="string" />
        <![CDATA[
            select o.global_office_num as globalOfficeNum, o.display_name as displayName
			from office o
			where o.office_level_id= :OFFICE_LEVEL_ID
        ]]>
	</sql-query>
	<sql-query name="ChartOfAccountsForMifos.ViewTransactions">
		<return-scalar column="transactionNo" type="int" />
		<return-scalar column="transactionDate" type="date" />
		<return-scalar column="transactionType" type="string" />
		<return-scalar column="officeLevel" type="string" />
		<return-scalar column="displayName" type="string" />
		<return-scalar column="mainAccount" type="string" />
		<return-scalar column="amountAction" type="string" />
		<return-scalar column="subAccount" type="string" />
		<return-scalar column="transactionAmount" type="big_decimal" />
		<return-scalar column="narration" type="string" />
        <![CDATA[
select m.transaction_master_id as transactionNo, transaction_date as transactionDate,
       	case transaction_type  when 'CP' then 'Cash Payment'
		              when 'CR' then 'Cash Receipt'
                              when 'BR' then 'Bank Receipt'
                              when 'BP' then 'Bank Payment'
                              when 'JV' then 'Journal Voucher'
                              else 'unknown' end as transactionType,
		         c.officelevel as officeLevel,display_name as displayName,
		(Select  coa_name  from coa a, gl_code b where a.glcode_id=b.glcode_id and glcode_value=m.main_account)  as
		         mainaccount,m.amount_action as amountaction,
		(Select  coa_name  from coa a, gl_code b where a.glcode_id=b.glcode_id and glcode_value=d.sub_account) as subaccount,m.transaction_amount as
		         transactionAmount,m.transaction_narration as narration
					from acc_glmaster m,acc_gldetail d,(
		           select global_cust_num global_num,
		                  case customer_level_id when 2 then 'Group'
		                                         When 3 then 'Center'
		                                         Else 'None' end as officelevel
		                 ,display_name
		           from customer c
		           where customer_level_id in (2,3)
		            union all
		          select global_office_num global_num,
		                  case office_level_id when 1 then 'Head Office'
		                                       When 2 then 'Regional Office'
					               When 3 then 'Divisional Office'
					               When 4 then 'Area Office'
					               When 5 then 'Branch Office'
						       Else 'None' end as officelevel
		                  ,display_name
		          from office o ) c
			where m.transaction_master_id=d.transaction_master_id
			  and m.from_office_id=c.global_num
			  and m.transaction_date between :FROM_TRANSACTION_DATE and :TO_TRANSACTION_DATE
			  Order by m.transaction_master_id
			  LIMIT :START_RECORD , :NUMBER_OF_RECORDS
        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.TotalNumberOfRecords">
		<return-scalar column="totalNumberOfRecords" type="int" />
        <![CDATA[
		select count(*) as totalNumberOfRecords
					from acc_glmaster m,acc_gldetail d,(
		           select global_cust_num global_num,
		                  case customer_level_id when 2 then 'Group'
		                                         When 3 then 'Center'
		                                         Else 'None' end as officelevel
		                 ,display_name
		           from customer c
		           where customer_level_id in (2,3)
		            union all
		          select global_office_num global_num,
		                  case office_level_id when 1 then 'Head Office'
		                                       When 2 then 'Regional Office'
					               When 3 then 'Divisional Office'
					               When 4 then 'Area Office'
					               When 5 then 'Branch Office'
						       Else 'None' end as officelevel
		                  ,display_name
		          from office o ) c
			where m.transaction_master_id=d.transaction_master_id
			  and m.from_office_id=c.global_num
			  and m.transaction_date between :FROM_TRANSACTION_DATE and :TO_TRANSACTION_DATE
			  Order by m.transaction_master_id
        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.GetExistedOpenBalance">
		<return-scalar column="glBalancesId" type="int" />
		<return-scalar column="officeLevel" type="int" />
		<return-scalar column="officeId" type="string" />
		<return-scalar column="glCodeValue" type="string" />
		<return-scalar column="openingBalance" type="big_decimal" />
		<return-scalar column="transactionDebitSum" type="big_decimal" />
		<return-scalar column="transactionCreditSum" type="big_decimal" />
		<return-scalar column="closingBalance" type="big_decimal" />
		<return-scalar column="createdBy" type="short" />
		<return-scalar column="createdDate" type="date" />
        <![CDATA[
			select ag.glbalances_id as glBalancesId,
       ag.office_level as officeLevel,ag.office_id as officeId,ag.glcode_value as glCodeValue,
       ag.openning_bal as openingBalance,ag.transaction_dr_sum as     transactionDebitSum,ag.transaction_cr_sum as transactionCreditSum,ag.closing_bal as closingBalance,
ag.created_by as createdBy,ag.created_date as createdDate
from acc_glbalances ag
where ag.office_id= :OFFICEID AND ag.office_level= :OFFICELEVEL AND ag.glcode_value= :COAID AND ag.financialyear_id= :FINANCIALYEARID
		]]>
	</sql-query>
	
	<sql-query name="ChartOfAccountsForMifos.YearEndProcessLiabilities">
		<return-scalar column="officeLevel" type="integer" />
		<return-scalar column="officeId" type="string" />
		<return-scalar column="glCodeValue" type="string" />
		<return-scalar column="openingBalance" type="big_decimal" />
		<return-scalar column="transactionDebitSum" type="big_decimal" />
		<return-scalar column="transactionCreditSum" type="big_decimal" />
		<return-scalar column="closingBalance" type="big_decimal" />
		<return-scalar column="createdDate" type="date" />
		<return-scalar column="createdBy" type="short" />
        <![CDATA[
           SELECT a.`office_level` as officeLevel, a.`office_id` as officeId, a.`glcode_value` as glCodeValue,a.`closing_bal` as openingBalance, 0  as transactionDebitSum, 0 as transactionCreditSum, 0 as closingBalance, a.`created_by` as createdBy, a.`created_date` as createdDate  FROM acc_glbalances a where financialyear_id=:FINANCIALYEARID and glcode_value in (SELECT DISTINCT liabilities.glcode_value
  FROM (SELECT gll.glcode_value
          FROM coahierarchy c
               LEFT JOIN coa co
                  ON co.coa_id = c.parent_coaid
               LEFT JOIN gl_code gl
                  ON gl.glcode_id = co.glcode_id
               LEFT JOIN coa coo
                  ON coo.coa_id = c.coa_id
               LEFT JOIN gl_code gll
                  ON gll.glcode_id = coo.glcode_id
         WHERE gl.glcode_value = (Select lookup_name from lookup_value a, lookup_entity b where a.entity_id=b.entity_id and entity_name='LIABILITY')
        UNION
        SELECT gll.glcode_value
          FROM coahierarchy c
               LEFT JOIN coa co
                  ON co.coa_id = c.parent_coaid
               LEFT JOIN gl_code gl
                  ON gl.glcode_id = co.glcode_id
               LEFT JOIN coa coo
                  ON coo.coa_id = c.coa_id
               LEFT JOIN gl_code gll
                  ON gll.glcode_id = coo.glcode_id
         WHERE gl.glcode_value IN (SELECT gll.glcode_value
                                     FROM coahierarchy c
                                          LEFT JOIN coa co
                                             ON co.coa_id = c.parent_coaid
                                          LEFT JOIN gl_code gl
                                             ON gl.glcode_id = co.glcode_id
                                          LEFT JOIN coa coo
                                             ON coo.coa_id = c.coa_id
                                          LEFT JOIN gl_code gll
                                             ON gll.glcode_id = coo.glcode_id
                                    WHERE gl.glcode_value = (Select lookup_name from lookup_value a, lookup_entity b where a.entity_id=b.entity_id and entity_name='LIABILITY'))
        UNION
        SELECT gll.glcode_value
          FROM coahierarchy c
               LEFT JOIN coa co
                  ON co.coa_id = c.parent_coaid
               LEFT JOIN gl_code gl
                  ON gl.glcode_id = co.glcode_id
               LEFT JOIN coa coo
                  ON coo.coa_id = c.coa_id
               LEFT JOIN gl_code gll
                  ON gll.glcode_id = coo.glcode_id
         WHERE gl.glcode_value IN
                  (SELECT gll.glcode_value
                     FROM coahierarchy c
                          LEFT JOIN coa co
                             ON co.coa_id = c.parent_coaid
                          LEFT JOIN gl_code gl
                             ON gl.glcode_id = co.glcode_id
                          LEFT JOIN coa coo
                             ON coo.coa_id = c.coa_id
                          LEFT JOIN gl_code gll
                             ON gll.glcode_id = coo.glcode_id
                    WHERE gl.glcode_value IN
                             (SELECT gll.glcode_value
                                FROM coahierarchy c
                                     LEFT JOIN coa co
                                        ON co.coa_id =
                                              c.parent_coaid
                                     LEFT JOIN gl_code gl
                                        ON gl.glcode_id =
                                              co.glcode_id
                                     LEFT JOIN coa coo
                                        ON coo.coa_id =
                                              c.coa_id
                                     LEFT JOIN gl_code gll
                                        ON gll.glcode_id =
                                              coo.glcode_id
                               WHERE gl.glcode_value = (Select lookup_name from lookup_value a, lookup_entity b where a.entity_id=b.entity_id and entity_name='LIABILITY')))
        UNION
        SELECT gll.glcode_value
          FROM coahierarchy c
               LEFT JOIN coa co
                  ON co.coa_id = c.parent_coaid
               LEFT JOIN gl_code gl
                  ON gl.glcode_id = co.glcode_id
               LEFT JOIN coa coo
                  ON coo.coa_id = c.coa_id
               LEFT JOIN gl_code gll
                  ON gll.glcode_id = coo.glcode_id
         WHERE gl.glcode_value IN
                  (SELECT gll.glcode_value
                     FROM coahierarchy c
                          LEFT JOIN coa co
                             ON co.coa_id = c.parent_coaid
                          LEFT JOIN gl_code gl
                             ON gl.glcode_id = co.glcode_id
                          LEFT JOIN coa coo
                             ON coo.coa_id = c.coa_id
                          LEFT JOIN gl_code gll
                             ON gll.glcode_id = coo.glcode_id
                    WHERE gl.glcode_value IN
                             (SELECT gll.glcode_value
                                FROM coahierarchy c
                                     LEFT JOIN coa co
                                        ON co.coa_id =
                                              c.parent_coaid
                                     LEFT JOIN gl_code gl
                                        ON gl.glcode_id =
                                              co.glcode_id
                                     LEFT JOIN coa coo
                                        ON coo.coa_id =
                                              c.coa_id
                                     LEFT JOIN gl_code gll
                                        ON gll.glcode_id =
                                              coo.glcode_id
                               WHERE gl.glcode_value IN
                                        (SELECT gll.glcode_value
                                           FROM coahierarchy c
                                                LEFT JOIN coa co
                                                   ON co.coa_id =
                                                         c.parent_coaid
                                                LEFT JOIN gl_code gl
                                                   ON gl.glcode_id =
                                                         co.glcode_id
                                                LEFT JOIN coa coo
                                                   ON coo.coa_id = c.coa_id
                                                LEFT JOIN gl_code gll
                                                   ON gll.glcode_id =
                                                         coo.glcode_id
                                          WHERE gl.glcode_value = (Select lookup_name from lookup_value a, lookup_entity b where a.entity_id=b.entity_id and entity_name='LIABILITY'))))
        UNION
        SELECT gll.glcode_value
          FROM coahierarchy c
               LEFT JOIN coa co
                  ON co.coa_id = c.parent_coaid
               LEFT JOIN gl_code gl
                  ON gl.glcode_id = co.glcode_id
               LEFT JOIN coa coo
                  ON coo.coa_id = c.coa_id
               LEFT JOIN gl_code gll
                  ON gll.glcode_id = coo.glcode_id
         WHERE gl.glcode_value IN
                  (SELECT gll.glcode_value
                     FROM coahierarchy c
                          LEFT JOIN coa co
                             ON co.coa_id = c.parent_coaid
                          LEFT JOIN gl_code gl
                             ON gl.glcode_id = co.glcode_id
                          LEFT JOIN coa coo
                             ON coo.coa_id = c.coa_id
                          LEFT JOIN gl_code gll
                             ON gll.glcode_id = coo.glcode_id
                    WHERE gl.glcode_value IN
                             (SELECT gll.glcode_value
                                FROM coahierarchy c
                                     LEFT JOIN coa co
                                        ON co.coa_id =
                                              c.parent_coaid
                                     LEFT JOIN gl_code gl
                                        ON gl.glcode_id =
                                              co.glcode_id
                                     LEFT JOIN coa coo
                                        ON coo.coa_id =
                                              c.coa_id
                                     LEFT JOIN gl_code gll
                                        ON gll.glcode_id =
                                              coo.glcode_id
                               WHERE gl.glcode_value IN
                                        (SELECT gll.glcode_value
                                           FROM coahierarchy c
                                                LEFT JOIN coa co
                                                   ON co.coa_id =
                                                         c.parent_coaid
                                                LEFT JOIN gl_code gl
                                                   ON gl.glcode_id =
                                                         co.glcode_id
                                                LEFT JOIN coa coo
                                                   ON coo.coa_id = c.coa_id
                                                LEFT JOIN gl_code gll
                                                   ON gll.glcode_id =
                                                         coo.glcode_id
                                          WHERE gl.glcode_value IN
                                                   (SELECT gll.glcode_value
                                                      FROM coahierarchy c
                                                           LEFT JOIN coa co
                                                              ON co.coa_id =
                                                                    c.parent_coaid
                                                           LEFT JOIN gl_code gl
                                                              ON gl.glcode_id =
                                                                    co.glcode_id
                                                           LEFT JOIN coa coo
                                                              ON coo.coa_id =
                                                                    c.coa_id
                                                           LEFT JOIN gl_code gll
                                                              ON gll.glcode_id =
                                                                    coo.glcode_id
                                                     WHERE gl.glcode_value =
                                                              (Select lookup_name from lookup_value a, lookup_entity b where a.entity_id=b.entity_id and entity_name='LIABILITY')))))
        UNION
        SELECT gll.glcode_value
          FROM coahierarchy c
               LEFT JOIN coa co
                  ON co.coa_id = c.parent_coaid
               LEFT JOIN gl_code gl
                  ON gl.glcode_id = co.glcode_id
               LEFT JOIN coa coo
                  ON coo.coa_id = c.coa_id
               LEFT JOIN gl_code gll
                  ON gll.glcode_id = coo.glcode_id
         WHERE gl.glcode_value IN
                  (SELECT gll.glcode_value
                     FROM coahierarchy c
                          LEFT JOIN coa co
                             ON co.coa_id = c.parent_coaid
                          LEFT JOIN gl_code gl
                             ON gl.glcode_id = co.glcode_id
                          LEFT JOIN coa coo
                             ON coo.coa_id = c.coa_id
                          LEFT JOIN gl_code gll
                             ON gll.glcode_id = coo.glcode_id
                    WHERE gl.glcode_value IN
                             (SELECT gll.glcode_value
                                FROM coahierarchy c
                                     LEFT JOIN coa co
                                        ON co.coa_id =
                                              c.parent_coaid
                                     LEFT JOIN gl_code gl
                                        ON gl.glcode_id =
                                              co.glcode_id
                                     LEFT JOIN coa coo
                                        ON coo.coa_id =
                                              c.coa_id
                                     LEFT JOIN gl_code gll
                                        ON gll.glcode_id =
                                              coo.glcode_id
                               WHERE gl.glcode_value IN
                                        (SELECT gll.glcode_value
                                           FROM coahierarchy c
                                                LEFT JOIN coa co
                                                   ON co.coa_id =
                                                         c.parent_coaid
                                                LEFT JOIN gl_code gl
                                                   ON gl.glcode_id =
                                                         co.glcode_id
                                                LEFT JOIN coa coo
                                                   ON coo.coa_id = c.coa_id
                                                LEFT JOIN gl_code gll
                                                   ON gll.glcode_id =
                                                         coo.glcode_id
                                          WHERE gl.glcode_value IN
                                                   (SELECT gll.glcode_value
                                                      FROM coahierarchy c
                                                           LEFT JOIN coa co
                                                              ON co.coa_id =
                                                                    c.parent_coaid
                                                           LEFT JOIN gl_code gl
                                                              ON gl.glcode_id =
                                                                    co.glcode_id
                                                           LEFT JOIN coa coo
                                                              ON coo.coa_id =
                                                                    c.coa_id
                                                           LEFT JOIN gl_code gll
                                                              ON gll.glcode_id =
                                                                    coo.glcode_id
                                                     WHERE gl.glcode_value IN
                                                              (SELECT gll.glcode_value
                                                                 FROM coahierarchy c
                                                                      LEFT JOIN coa co
                                                                         ON co.coa_id =
                                                                               c.parent_coaid
                                                                      LEFT JOIN gl_code gl
                                                                         ON gl.glcode_id =
                                                                               co.glcode_id
                                                                      LEFT JOIN coa coo
                                                                         ON coo.coa_id =
                                                                               c.coa_id
                                                                      LEFT JOIN gl_code gll
                                                                         ON gll.glcode_id =
                                                                               coo.glcode_id
                                                                WHERE gl.glcode_value =
                                                                         (Select lookup_name from lookup_value a, lookup_entity b where a.entity_id=b.entity_id and entity_name='LIABILITY'))))))) liabilities);
        ]]>
	</sql-query>
	
	<sql-query name="ChartOfAccountsForMifos.YearEndProcessAssets">
		<return-scalar column="officeLevel" type="integer" />
		<return-scalar column="officeId" type="string" />
		<return-scalar column="glCodeValue" type="string" />
		<return-scalar column="openingBalance" type="big_decimal" />
		<return-scalar column="transactionDebitSum" type="big_decimal" />
		<return-scalar column="transactionCreditSum" type="big_decimal" />
		<return-scalar column="closingBalance" type="big_decimal" />
		<return-scalar column="createdDate" type="date" />
		<return-scalar column="createdBy" type="short" />
        <![CDATA[
            SELECT a.`office_level` as officeLevel, a.`office_id` as officeId, a.`glcode_value` as glCodeValue,a.`closing_bal` as openingBalance, 0  as transactionDebitSum, 0 as transactionCreditSum, 0 as closingBalance, a.`created_by` as createdBy, a.`created_date` as createdDate FROM acc_glbalances a where financialyear_id=:FINANCIALYEARID AND glcode_value in (SELECT DISTINCT assets.glcode_value
  FROM (SELECT gll.glcode_value
          FROM coahierarchy c
               LEFT JOIN coa co
                  ON co.coa_id = c.parent_coaid
               LEFT JOIN gl_code gl
                  ON gl.glcode_id = co.glcode_id
               LEFT JOIN coa coo
                  ON coo.coa_id = c.coa_id
               LEFT JOIN gl_code gll
                  ON gll.glcode_id = coo.glcode_id
         WHERE gl.glcode_value = (Select lookup_name from lookup_value a, lookup_entity b where a.entity_id=b.entity_id and entity_name='ASSET')
        UNION
        SELECT gll.glcode_value
          FROM coahierarchy c
               LEFT JOIN coa co
                  ON co.coa_id = c.parent_coaid
               LEFT JOIN gl_code gl
                  ON gl.glcode_id = co.glcode_id
               LEFT JOIN coa coo
                  ON coo.coa_id = c.coa_id
               LEFT JOIN gl_code gll
                  ON gll.glcode_id = coo.glcode_id
         WHERE gl.glcode_value IN (SELECT gll.glcode_value
                                     FROM coahierarchy c
                                          LEFT JOIN coa co
                                             ON co.coa_id = c.parent_coaid
                                          LEFT JOIN gl_code gl
                                             ON gl.glcode_id = co.glcode_id
                                          LEFT JOIN coa coo
                                             ON coo.coa_id = c.coa_id
                                          LEFT JOIN gl_code gll
                                             ON gll.glcode_id = coo.glcode_id
                                    WHERE gl.glcode_value = (Select lookup_name from lookup_value a, lookup_entity b where a.entity_id=b.entity_id and entity_name='ASSET'))
        UNION
        SELECT gll.glcode_value
          FROM coahierarchy c
               LEFT JOIN coa co
                  ON co.coa_id = c.parent_coaid
               LEFT JOIN gl_code gl
                  ON gl.glcode_id = co.glcode_id
               LEFT JOIN coa coo
                  ON coo.coa_id = c.coa_id
               LEFT JOIN gl_code gll
                  ON gll.glcode_id = coo.glcode_id
         WHERE gl.glcode_value IN
                  (SELECT gll.glcode_value
                     FROM coahierarchy c
                          LEFT JOIN coa co
                             ON co.coa_id = c.parent_coaid
                          LEFT JOIN gl_code gl
                             ON gl.glcode_id = co.glcode_id
                          LEFT JOIN coa coo
                             ON coo.coa_id = c.coa_id
                          LEFT JOIN gl_code gll
                             ON gll.glcode_id = coo.glcode_id
                    WHERE gl.glcode_value IN
                             (SELECT gll.glcode_value
                                FROM coahierarchy c
                                     LEFT JOIN coa co
                                        ON co.coa_id =
                                              c.parent_coaid
                                     LEFT JOIN gl_code gl
                                        ON gl.glcode_id =
                                              co.glcode_id
                                     LEFT JOIN coa coo
                                        ON coo.coa_id =
                                              c.coa_id
                                     LEFT JOIN gl_code gll
                                        ON gll.glcode_id =
                                              coo.glcode_id
                               WHERE gl.glcode_value = (Select lookup_name from lookup_value a, lookup_entity b where a.entity_id=b.entity_id and entity_name='ASSET')))
        UNION
        SELECT gll.glcode_value
          FROM coahierarchy c
               LEFT JOIN coa co
                  ON co.coa_id = c.parent_coaid
               LEFT JOIN gl_code gl
                  ON gl.glcode_id = co.glcode_id
               LEFT JOIN coa coo
                  ON coo.coa_id = c.coa_id
               LEFT JOIN gl_code gll
                  ON gll.glcode_id = coo.glcode_id
         WHERE gl.glcode_value IN
                  (SELECT gll.glcode_value
                     FROM coahierarchy c
                          LEFT JOIN coa co
                             ON co.coa_id = c.parent_coaid
                          LEFT JOIN gl_code gl
                             ON gl.glcode_id = co.glcode_id
                          LEFT JOIN coa coo
                             ON coo.coa_id = c.coa_id
                          LEFT JOIN gl_code gll
                             ON gll.glcode_id = coo.glcode_id
                    WHERE gl.glcode_value IN
                             (SELECT gll.glcode_value
                                FROM coahierarchy c
                                     LEFT JOIN coa co
                                        ON co.coa_id =
                                              c.parent_coaid
                                     LEFT JOIN gl_code gl
                                        ON gl.glcode_id =
                                              co.glcode_id
                                     LEFT JOIN coa coo
                                        ON coo.coa_id =
                                              c.coa_id
                                     LEFT JOIN gl_code gll
                                        ON gll.glcode_id =
                                              coo.glcode_id
                               WHERE gl.glcode_value IN
                                        (SELECT gll.glcode_value
                                           FROM coahierarchy c
                                                LEFT JOIN coa co
                                                   ON co.coa_id =
                                                         c.parent_coaid
                                                LEFT JOIN gl_code gl
                                                   ON gl.glcode_id =
                                                         co.glcode_id
                                                LEFT JOIN coa coo
                                                   ON coo.coa_id = c.coa_id
                                                LEFT JOIN gl_code gll
                                                   ON gll.glcode_id =
                                                         coo.glcode_id
                                          WHERE gl.glcode_value = (Select lookup_name from lookup_value a, lookup_entity b where a.entity_id=b.entity_id and entity_name='ASSET'))))
        UNION
        SELECT gll.glcode_value
          FROM coahierarchy c
               LEFT JOIN coa co
                  ON co.coa_id = c.parent_coaid
               LEFT JOIN gl_code gl
                  ON gl.glcode_id = co.glcode_id
               LEFT JOIN coa coo
                  ON coo.coa_id = c.coa_id
               LEFT JOIN gl_code gll
                  ON gll.glcode_id = coo.glcode_id
         WHERE gl.glcode_value IN
                  (SELECT gll.glcode_value
                     FROM coahierarchy c
                          LEFT JOIN coa co
                             ON co.coa_id = c.parent_coaid
                          LEFT JOIN gl_code gl
                             ON gl.glcode_id = co.glcode_id
                          LEFT JOIN coa coo
                             ON coo.coa_id = c.coa_id
                          LEFT JOIN gl_code gll
                             ON gll.glcode_id = coo.glcode_id
                    WHERE gl.glcode_value IN
                             (SELECT gll.glcode_value
                                FROM coahierarchy c
                                     LEFT JOIN coa co
                                        ON co.coa_id =
                                              c.parent_coaid
                                     LEFT JOIN gl_code gl
                                        ON gl.glcode_id =
                                              co.glcode_id
                                     LEFT JOIN coa coo
                                        ON coo.coa_id =
                                              c.coa_id
                                     LEFT JOIN gl_code gll
                                        ON gll.glcode_id =
                                              coo.glcode_id
                               WHERE gl.glcode_value IN
                                        (SELECT gll.glcode_value
                                           FROM coahierarchy c
                                                LEFT JOIN coa co
                                                   ON co.coa_id =
                                                         c.parent_coaid
                                                LEFT JOIN gl_code gl
                                                   ON gl.glcode_id =
                                                         co.glcode_id
                                                LEFT JOIN coa coo
                                                   ON coo.coa_id = c.coa_id
                                                LEFT JOIN gl_code gll
                                                   ON gll.glcode_id =
                                                         coo.glcode_id
                                          WHERE gl.glcode_value IN
                                                   (SELECT gll.glcode_value
                                                      FROM coahierarchy c
                                                           LEFT JOIN coa co
                                                              ON co.coa_id =
                                                                    c.parent_coaid
                                                           LEFT JOIN gl_code gl
                                                              ON gl.glcode_id =
                                                                    co.glcode_id
                                                           LEFT JOIN coa coo
                                                              ON coo.coa_id =
                                                                    c.coa_id
                                                           LEFT JOIN gl_code gll
                                                              ON gll.glcode_id =
                                                                    coo.glcode_id
                                                     WHERE gl.glcode_value =
                                                              (Select lookup_name from lookup_value a, lookup_entity b where a.entity_id=b.entity_id and entity_name='ASSET')))))
        UNION
        SELECT gll.glcode_value
          FROM coahierarchy c
               LEFT JOIN coa co
                  ON co.coa_id = c.parent_coaid
               LEFT JOIN gl_code gl
                  ON gl.glcode_id = co.glcode_id
               LEFT JOIN coa coo
                  ON coo.coa_id = c.coa_id
               LEFT JOIN gl_code gll
                  ON gll.glcode_id = coo.glcode_id
         WHERE gl.glcode_value IN
                  (SELECT gll.glcode_value
                     FROM coahierarchy c
                          LEFT JOIN coa co
                             ON co.coa_id = c.parent_coaid
                          LEFT JOIN gl_code gl
                             ON gl.glcode_id = co.glcode_id
                          LEFT JOIN coa coo
                             ON coo.coa_id = c.coa_id
                          LEFT JOIN gl_code gll
                             ON gll.glcode_id = coo.glcode_id
                    WHERE gl.glcode_value IN
                             (SELECT gll.glcode_value
                                FROM coahierarchy c
                                     LEFT JOIN coa co
                                        ON co.coa_id =
                                              c.parent_coaid
                                     LEFT JOIN gl_code gl
                                        ON gl.glcode_id =
                                              co.glcode_id
                                     LEFT JOIN coa coo
                                        ON coo.coa_id =
                                              c.coa_id
                                     LEFT JOIN gl_code gll
                                        ON gll.glcode_id =
                                              coo.glcode_id
                               WHERE gl.glcode_value IN
                                        (SELECT gll.glcode_value
                                           FROM coahierarchy c
                                                LEFT JOIN coa co
                                                   ON co.coa_id =
                                                         c.parent_coaid
                                                LEFT JOIN gl_code gl
                                                   ON gl.glcode_id =
                                                         co.glcode_id
                                                LEFT JOIN coa coo
                                                   ON coo.coa_id = c.coa_id
                                                LEFT JOIN gl_code gll
                                                   ON gll.glcode_id =
                                                         coo.glcode_id
                                          WHERE gl.glcode_value IN
                                                   (SELECT gll.glcode_value
                                                      FROM coahierarchy c
                                                           LEFT JOIN coa co
                                                              ON co.coa_id =
                                                                    c.parent_coaid
                                                           LEFT JOIN gl_code gl
                                                              ON gl.glcode_id =
                                                                    co.glcode_id
                                                           LEFT JOIN coa coo
                                                              ON coo.coa_id =
                                                                    c.coa_id
                                                           LEFT JOIN gl_code gll
                                                              ON gll.glcode_id =
                                                                    coo.glcode_id
                                                     WHERE gl.glcode_value IN
                                                              (SELECT gll.glcode_value
                                                                 FROM coahierarchy c
                                                                      LEFT JOIN coa co
                                                                         ON co.coa_id =
                                                                               c.parent_coaid
                                                                      LEFT JOIN gl_code gl
                                                                         ON gl.glcode_id =
                                                                               co.glcode_id
                                                                      LEFT JOIN coa coo
                                                                         ON coo.coa_id =
                                                                               c.coa_id
                                                                      LEFT JOIN gl_code gll
                                                                         ON gll.glcode_id =
                                                                               coo.glcode_id
                                                                WHERE gl.glcode_value =
                                                                         (Select lookup_name from lookup_value a, lookup_entity b where a.entity_id=b.entity_id and entity_name='ASSET'))))))) assets
);
        ]]>
	</sql-query>
	
<!-- end of stage transaction -->
	<!-- Number of stage records -->
	<sql-query name="ChartOfAccountsForMifos.TotalNumberOfStageRecords">
		<return-scalar column="totalNumberOfRecords" type="int" />
        <![CDATA[
		select count(*) as totalNumberOfRecords

                    from acc_glmaster m,acc_gldetail d,(
                   select global_cust_num global_num,
                          case customer_level_id when 2 then 'Group'
                                                 When 3 then 'Center'
                                                 Else 'None' end as officelevel
                         ,display_name
                   from customer c
                   where customer_level_id in (2,3)

                    union all
                  select global_office_num global_num,
                          case office_level_id when 1 then 'Head Office'
                                               When 2 then 'Regional Office'
                                   When 3 then 'Divisional Office'
                                   When 4 then 'Area Office'
                                   When 5 then 'Branch Office'
                               Else 'None' end as officelevel
                          ,display_name
                  from office o ) c
            where m.transaction_master_id=d.transaction_master_id
              and m.from_office_id=c.global_num
        and m.stage=0
              Order by m.transaction_master_id
        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.updateStageTransactions">
		<![CDATA[
		  update acc_glmaster set stage = :STAGE where transaction_master_id = :TRANSACTION_NO
		]]>
	</sql-query>

	<!-- Hugo Technologies Edit stage Transaction -->
	<sql-query name="ChartOfAccountsForMifos.EditStageTransactions">
		<return-scalar column="transactionNo" type="int" />
		<return-scalar column="transactionDate" type="date" />
		<return-scalar column="transactionType" type="string" />
		<return-scalar column="officeLevel" type="string" />
		<return-scalar column="displayName" type="string" />
		<return-scalar column="mainAccount" type="string" />
		<return-scalar column="amountAction" type="string" />
		<return-scalar column="subAccount" type="string" />
		<return-scalar column="transactionAmount" type="big_decimal" />
		<return-scalar column="narration" type="string" />
		<return-scalar column="fromOfficeId" type="string" />
		<return-scalar column="transactionID" type="int" />

        <![CDATA[
			SELECT m.transaction_master_id AS transactionNo,
       transaction_date AS transactionDate,
       from_office_id AS fromOfficeId,
       CASE transaction_type
          WHEN 'CP' THEN 'Cash Payment'
          WHEN 'CR' THEN 'Cash Receipt'
          WHEN 'BR' THEN 'Bank Receipt'
          WHEN 'BP' THEN 'Bank Payment'
          WHEN 'JV' THEN 'Journal Voucher'
          ELSE 'unknown'
       END AS transactionType,
       c.officelevel AS officeLevel,
       display_name AS displayName,
       (SELECT b.glcode_value FROM coa a, gl_code b WHERE a.glcode_id = b.glcode_id AND glcode_value = m.main_account) AS mainaccount,
       m.amount_action AS amountaction,
       (SELECT b.glcode_value FROM coa a, gl_code b WHERE a.glcode_id = b.glcode_id AND glcode_value = d.sub_account) AS subaccount,
       m.transaction_amount AS transactionAmount,
       m.transaction_narration AS narration,
       m.stage,
       d.transaction_id As transactionId
  FROM acc_glmaster m,acc_gldetail d,
       (SELECT global_cust_num global_num,
               CASE customer_level_id
                  WHEN 2 THEN 'Group'
                  WHEN 3 THEN 'Center'
                  ELSE 'None'
               END AS officelevel,
               display_name
          FROM customer c
        WHERE customer_level_id IN (2, 3)
        UNION ALL
        SELECT global_office_num global_num,
               CASE office_level_id
                  WHEN 1 THEN 'Head Office'
                  WHEN 2 THEN 'Regional Office'
                  WHEN 3 THEN 'Divisional Office'
                  WHEN 4 THEN 'Area Office'
                  WHEN 5 THEN 'Branch Office'
                  ELSE 'None'
               END AS officelevel,
               display_name
          FROM office o) c
 WHERE     m.transaction_master_id = d.transaction_master_id
       AND m.from_office_id = c.global_num
       and m.transaction_master_id = :TRANSACTION_NO
       ORDER BY m.transaction_master_id
        ]]>
	</sql-query>
	<sql-query name="ChartOfAccountsForMifos.chequeDetails">
		<return-scalar column="transactionNo" type="int" />
		<return-scalar column="chequeNo" type="string" />
		<return-scalar column="chequeDate" type="date" />
		<return-scalar column="bankName" type="string" />
		<return-scalar column="bankBranch" type="string" />

        <![CDATA[
			SELECT
			d.transaction_master_id as transactionNo,
			d.cheque_no as chequeNo,
			d.cheque_date as chequeDate ,
			d.bank_name as bankName,
			d.bank_branch as bankBranch
							 FROM acc_gldetail as d
							 where transaction_master_id = :TRANSACTION_NO
        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.AuditGlCodes">
		<return-scalar column="glcode" type="string" />
		<return-scalar column="glname" type="string" />
        <![CDATA[
				SELECT gll.glcode_value as glcode, coo.coa_name as glname
	FROM coahierarchy c
	LEFT JOIN coa co ON co.coa_id = c.parent_coaid
	LEFT JOIN gl_code gl ON gl.glcode_id = co.glcode_id
	LEFT JOIN coa coo ON coo.coa_id = c.coa_id
	LEFT JOIN gl_code gll ON gll.glcode_id = coo.glcode_id order by 1;
        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.ViewAuditTransactions">
		<return-scalar column="transactionNo" type="int" />
		<return-scalar column="transactionDate" type="date" />
		<return-scalar column="transactionType" type="string" />
		<return-scalar column="officeLevel" type="string" />
		<return-scalar column="displayName" type="string" />
		<return-scalar column="mainAccount" type="string" />
		<return-scalar column="amountAction" type="string" />
		<return-scalar column="subAccount" type="string" />
		<return-scalar column="transactionAmount" type="big_decimal" />
		<return-scalar column="narration" type="string" />
		<return-scalar column="transactionID" type="int" />
		<return-scalar column="audit" type="string" />

        <![CDATA[
SELECT m.transaction_master_id AS transactionNo,
       transaction_date AS transactionDate,
       CASE transaction_type
          WHEN 'CP' THEN 'Cash Payment'
          WHEN 'CR' THEN 'Cash Receipt'
          WHEN 'BR' THEN 'Bank Receipt'
          WHEN 'BP' THEN 'Bank Payment'
          WHEN 'JV' THEN 'Journal Voucher'
          ELSE 'unknown'
       END AS transactionType,
       c.officelevel AS officeLevel,
       display_name AS displayName,
       (SELECT coa_name FROM coa a, gl_code b WHERE a.glcode_id = b.glcode_id AND glcode_value = m.main_account) AS mainaccount,
       m.amount_action AS amountaction,
       (SELECT coa_name FROM coa a, gl_code b WHERE a.glcode_id = b.glcode_id AND glcode_value = d.sub_account) AS subaccount,
       m.transaction_amount AS transactionAmount,
       m.transaction_narration AS narration,
       m.stage,
       d.transaction_id AS transactionID,
       m.audit as audit
  FROM acc_glmaster m,acc_gldetail d,
       (SELECT global_cust_num global_num,
               CASE customer_level_id
                  WHEN 2 THEN 'Group'
                  WHEN 3 THEN 'Center'
                  ELSE 'None'
               END AS officelevel,
               display_name
          FROM customer c
        WHERE customer_level_id IN (2, 3)
        UNION ALL
        SELECT global_office_num global_num,
               CASE office_level_id
                  WHEN 1 THEN 'Head Office'
                  WHEN 2 THEN 'Regional Office'
                  WHEN 3 THEN 'Divisional Office'
                  WHEN 4 THEN 'Area Office'
                  WHEN 5 THEN 'Branch Office'
                  ELSE 'None'
               END AS officelevel,
               display_name
          FROM office o) c
 WHERE     m.transaction_master_id = d.transaction_master_id
       AND m.from_office_id = c.global_num
       and m.stage=1
       and m.transaction_date between :FROM_DATE and :TO_DATE
       ORDER BY m.transaction_master_id

       LIMIT :START_RECORD , :NUMBER_OF_RECORDS
        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.TotalNumberOfAuditRecords">
		<return-scalar column="totalNumberOfRecords" type="int" />
        <![CDATA[
		select count(*) as totalNumberOfRecords

                    from acc_glmaster m,acc_gldetail d,(
                   select global_cust_num global_num,
                          case customer_level_id when 2 then 'Group'
                                                 When 3 then 'Center'
                                                 Else 'None' end as officelevel
                         ,display_name
                   from customer c
                   where customer_level_id in (2,3)

                    union all
                  select global_office_num global_num,
                          case office_level_id when 1 then 'Head Office'
                                               When 2 then 'Regional Office'
                                   When 3 then 'Divisional Office'
                                   When 4 then 'Area Office'
                                   When 5 then 'Branch Office'
                               Else 'None' end as officelevel
                          ,display_name
                  from office o ) c
            where m.transaction_master_id=d.transaction_master_id
              and m.from_office_id=c.global_num
        and m.stage=1
        and m.transaction_date between :FROM_DATE and :TO_DATE
              Order by m.transaction_master_id
        ]]>
	</sql-query>
	<sql-query name="ChartOfAccountsForMifos.auditTransactions">
	<![CDATA[
		  update acc_glmaster set audit = :AUDIT,audit_comments = :AUDIT_COMMENTS where transaction_master_id = :TRANSACTION_NO
		]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.ViewStageTransactions">
		<return-scalar column="transactionNo" type="int" />
		<return-scalar column="transactionDate" type="date" />
		<return-scalar column="transactionType" type="string" />
		<return-scalar column="officeLevel" type="string" />
		<return-scalar column="displayName" type="string" />
		<return-scalar column="mainAccount" type="string" />
		<return-scalar column="amountAction" type="string" />
		<return-scalar column="subAccount" type="string" />
		<return-scalar column="transactionAmount" type="big_decimal" />
		<return-scalar column="narration" type="string" />
		<return-scalar column="transactionID" type="int" />
		<return-scalar column="audit" type="string" />
        <![CDATA[
SELECT m.transaction_master_id AS transactionNo,
       transaction_date AS transactionDate,
       CASE transaction_type
          WHEN 'CP' THEN 'Cash Payment'
          WHEN 'CR' THEN 'Cash Receipt'
          WHEN 'BR' THEN 'Bank Receipt'
          WHEN 'BP' THEN 'Bank Payment'
          WHEN 'JV' THEN 'Journal Voucher'
          ELSE 'unknown'
       END AS transactionType,
       c.officelevel AS officeLevel,
       display_name AS displayName,
       (SELECT coa_name FROM coa a, gl_code b WHERE a.glcode_id = b.glcode_id AND glcode_value = m.main_account) AS mainaccount,
       m.amount_action AS amountaction,
       (SELECT coa_name FROM coa a, gl_code b WHERE a.glcode_id = b.glcode_id AND glcode_value = d.sub_account) AS subaccount,
       d.transaction_amount AS transactionAmount,
       m.transaction_narration AS narration,
       m.stage,
       d.transaction_id AS transactionID,
       m.audit as audit
  FROM acc_glmaster m,acc_gldetail d,
       (SELECT global_cust_num global_num,
               CASE customer_level_id
                  WHEN 2 THEN 'Group'
                  WHEN 3 THEN 'Center'
                  ELSE 'None'
               END AS officelevel,
               display_name
          FROM customer c
        WHERE customer_level_id IN (2, 3)
        UNION ALL
        SELECT global_office_num global_num,
               CASE office_level_id
                  WHEN 1 THEN 'Head Office'
                  WHEN 2 THEN 'Regional Office'
                  WHEN 3 THEN 'Divisional Office'
                  WHEN 4 THEN 'Area Office'
                  WHEN 5 THEN 'Branch Office'
                  ELSE 'None'
               END AS officelevel,
               display_name
          FROM office o) c
 WHERE     m.transaction_master_id = d.transaction_master_id
       AND m.from_office_id = c.global_num
       and m.stage=0
       ORDER BY m.transaction_master_id
       LIMIT :START_RECORD , :NUMBER_OF_RECORDS
        ]]>
	</sql-query>

	<!-- end of stage transaction -->
	<!-- Number of stage records -->

	<!-- start Inter office transcefer -->

	<sql-query name="ChartOfAccountsForMifos.CashAndBank">
		<return-scalar column="glcode" type="string" />
		<return-scalar column="glname" type="string" />
        <![CDATA[
            Select b.glcode_value as glcode,a.coa_name as glname from coa a,gl_code b where a.glcode_id=b.glcode_id
			and glcode_value in (Select lookup_name from lookup_value where entity_id in
			(Select entity_id from lookup_entity where entity_name='Cash'))
			union
			Select b.glcode_value as glcode,a.coa_name as glname from coa a,gl_code b where a.glcode_id=b.glcode_id
			and glcode_value in (Select lookup_name from lookup_value where entity_id in
			(Select entity_id from lookup_entity where entity_name='Bank'));
        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.customerExcludeOfficeId">
		<return-scalar column="globalOfficeNum" type="string" />
		<return-scalar column="displayName" type="string" />
        <![CDATA[
            select c.global_cust_num as globalOfficeNum, c.display_name as displayName
            from customer c
            where c.customer_level_id= :CUSTOMER_LEVEL_ID
            and c.global_cust_num <> :OFFICE_ID
        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.officeExcludeOfficeId">
		<return-scalar column="globalOfficeNum" type="string" />
		<return-scalar column="displayName" type="string" />
        <![CDATA[
			select o.global_office_num as globalOfficeNum, o.display_name as displayName
			from office o
			where o.office_level_id= :OFFICE_LEVEL_ID
			and o.global_office_num <> :OFFICE_ID
        ]]>
	</sql-query>

	<!-- End Inter office transcefer -->

	<!-- process operations -->
	<sql-query name="ChartOfAccountsForMifos.getListOfOffices">

		<return-scalar column="officeId" type="int" />
		<return-scalar column="customerId" type="int" />
		<return-scalar column="displayName" type="string" />
		<return-scalar column="officeLevelId" type="int" />
		<return-scalar column="globalOfficeNumber" type="string" />
		<return-scalar column="globalCustomerNumber" type="string" />

        <![CDATA[

--  groups query

select '0' as officeId,customer_id as customerId,display_name as displayName,
-- '0' as office_level_id,
case customer_level_id
when '2' then '7'
else '0'
end as officeLevelId,customer_level_id as customerLevelId,'0' as globalOfficeNumber,global_cust_num as globalCustomerNumber from customer where parent_customer_id in(

select  customer_id from customer where customer_level_id=3 and branch_id in(select office_id from(( -- bo
 SELECT

  case office_id
  when '' then '0'
  when null then '0'
  else office_id
  end as 'office_id'

 FROM
   office
 WHERE
   parent_office_id IN
     ( -- ao
      SELECT
        office_id
      FROM
        office
      WHERE
        parent_office_id IN
          ( -- do
           SELECT
             office_id
           FROM
             office
           WHERE
             parent_office_id IN
               ( -- ro
                SELECT
                  office_id
                FROM
                  office
                WHERE
                  parent_office_id IN ( -- ho
                                       SELECT
                                         office_id
                                       FROM
                                         office
                                       WHERE
                                         office_level_id = :OFFICE_LEVEL_ID AND
                                         office_id = :OFFICE_ID)))))
UNION
( -- areas query
 SELECT
   case office_id
  when '' then '0'
  when null then '0'
  else office_id
  end as 'office_id'
 FROM
   office
 WHERE
   parent_office_id IN
     ( -- do
      SELECT
        office_id
      FROM
        office
      WHERE
        parent_office_id IN ( -- ro
                             SELECT
                               office_id
                             FROM
                               office
                             WHERE
                               parent_office_id IN ( -- ho
                                                    SELECT
                                                      office_id
                                                    FROM
                                                      office
                                                    WHERE
                                                      office_level_id = :OFFICE_LEVEL_ID AND
                                                      office_id = :OFFICE_ID))))
UNION
( -- divisional query
 SELECT
   case office_id
  when '' then '0'
  when null then '0'
  else office_id
  end as 'office_id'
 FROM
   office
 WHERE
   parent_office_id IN ( -- ro
                        SELECT
                          office_id
                        FROM
                          office
                        WHERE
                          parent_office_id IN ( -- ho
                                               SELECT
                                                 office_id
                                               FROM
                                                 office
                                               WHERE
                                                 office_level_id = :OFFICE_LEVEL_ID AND
                                                 office_id = :OFFICE_ID)))
UNION
( -- regional query
 SELECT
  case office_id
  when '' then '0'
  when null then '0'
  else office_id
  end as 'office_id'
 FROM
   office
 WHERE
   parent_office_id IN ( -- ho
                        SELECT
                          office_id
                        FROM
                          office
                        WHERE
                          office_level_id = :OFFICE_LEVEL_ID AND
                          office_id = :OFFICE_ID))
union
( -- Head office query
                         select case office_id
  when '' then '0'
  when null then '0'
  else office_id
  end as 'office_id' from office where office_level_id = :OFFICE_LEVEL_ID and office_id = :OFFICE_ID))x))

union

-- centers query

select '0' as officeId ,customer_id as customerId,display_name as displayName,
-- '0' as office_level_id,
case customer_level_id
when '3' then '6'
else '0'
end as officeLevelId,customer_level_id as customerLevelId,'0' as globalOfficeNumber,global_cust_num as globalCustomerNumber from customer where customer_level_id=3 and branch_id in(select office_id from(( -- bo
 SELECT

  case office_id
  when '' then '0'
  when null then '0'
  else office_id
  end as 'office_id'

 FROM
   office
 WHERE
   parent_office_id IN
     ( -- ao
      SELECT
        office_id
      FROM
        office
      WHERE
        parent_office_id IN
          ( -- do
           SELECT
             office_id
           FROM
             office
           WHERE
             parent_office_id IN
               ( -- ro
                SELECT
                  office_id
                FROM
                  office
                WHERE
                  parent_office_id IN ( -- ho
                                       SELECT
                                         office_id
                                       FROM
                                         office
                                       WHERE
                                         office_level_id = :OFFICE_LEVEL_ID AND
                                         office_id = :OFFICE_ID)))))
UNION
( -- areas query
 SELECT
   case office_id
  when '' then '0'
  when null then '0'
  else office_id
  end as 'office_id'
 FROM
   office
 WHERE
   parent_office_id IN
     ( -- do
      SELECT
        office_id
      FROM
        office
      WHERE
        parent_office_id IN ( -- ro
                             SELECT
                               office_id
                             FROM
                               office
                             WHERE
                               parent_office_id IN ( -- ho
                                                    SELECT
                                                      office_id
                                                    FROM
                                                      office
                                                    WHERE
                                                      office_level_id = :OFFICE_LEVEL_ID AND
                                                      office_id = :OFFICE_ID))))
UNION
( -- divisional query
 SELECT
   case office_id
  when '' then '0'
  when null then '0'
  else office_id
  end as 'office_id'
 FROM
   office
 WHERE
   parent_office_id IN ( -- ro
                        SELECT
                          office_id
                        FROM
                          office
                        WHERE
                          parent_office_id IN ( -- ho
                                               SELECT
                                                 office_id
                                               FROM
                                                 office
                                               WHERE
                                                 office_level_id = :OFFICE_LEVEL_ID AND
                                                 office_id = :OFFICE_ID)))
UNION
( -- regional query
 SELECT
  case office_id
  when '' then '0'
  when null then '0'
  else office_id
  end as 'office_id'
 FROM
   office
 WHERE
   parent_office_id IN ( -- ho
                        SELECT
                          office_id
                        FROM
                          office
                        WHERE
                          office_level_id = :OFFICE_LEVEL_ID AND
                          office_id = :OFFICE_ID))
union
( -- Head office query
                         select case office_id
  when '' then '0'
  when null then '0'
  else office_id
  end as 'office_id' from office where office_level_id = :OFFICE_LEVEL_ID and office_id = :OFFICE_ID))x)

union
-- **
-- branches query
( -- bo
 SELECT
   office_id as officeId,'0' as customerId,display_name as displayName,office_level_id as officeLevelId,'0' as customerLevelId,global_office_num as globalOfficeNumber,'0' as globalCustomerNumber
 FROM
   office
 WHERE
   parent_office_id IN
     ( -- ao
      SELECT
        office_id
      FROM
        office
      WHERE
        parent_office_id IN
          ( -- do
           SELECT
             office_id
           FROM
             office
           WHERE
             parent_office_id IN
               ( -- ro
                SELECT
                  office_id
                FROM
                  office
                WHERE
                  parent_office_id IN ( -- ho
                                       SELECT
                                         office_id
                                       FROM
                                         office
                                       WHERE
                                         office_level_id = :OFFICE_LEVEL_ID AND
                                         office_id = :OFFICE_ID)))))
UNION
-- **
-- areas query
(
 SELECT
   office_id as officeId,'0' as customerId,display_name as displayName,office_level_id as officeLevelId,'0' as customerLevelId,global_office_num as globalOfficeNumber,'0' as globalCustomerNumber
 FROM
   office
 WHERE
   parent_office_id IN
     ( -- do
      SELECT
        office_id
      FROM
        office
      WHERE
        parent_office_id IN ( -- ro
                             SELECT
                               office_id
                             FROM
                               office
                             WHERE
                               parent_office_id IN ( -- ho
                                                    SELECT
                                                      office_id
                                                    FROM
                                                      office
                                                    WHERE
                                                      office_level_id = :OFFICE_LEVEL_ID AND
                                                      office_id = :OFFICE_ID))))
UNION
-- **
-- divisional query
(
 SELECT
   office_id as officeId,'0' as customerId,display_name as displayName,office_level_id as officeLevelId,'0' as customerLevelId,global_office_num as globalOfficeNumber,'0' as globalCustomerNumber
 FROM
   office
 WHERE
   parent_office_id IN ( -- ro
                        SELECT
                          office_id
                        FROM
                          office
                        WHERE
                          parent_office_id IN ( -- ho
                                               SELECT
                                                 office_id
                                               FROM
                                                 office
                                               WHERE
                                                 office_level_id = :OFFICE_LEVEL_ID AND
                                                 office_id = :OFFICE_ID)))
UNION
-- **
-- regional query
(
 SELECT
   office_id as officeId,'0' as customerId,display_name as displayName,office_level_id as officeLevelId,'0' as customerLevelId,global_office_num as globalOfficeNumber,'0' as globalCustomerNumber
 FROM
   office
 WHERE
   parent_office_id IN ( -- ho
                        SELECT
                          office_id
                        FROM
                          office
                        WHERE
                          office_level_id = :OFFICE_LEVEL_ID AND
                          office_id = :OFFICE_ID))
                          union
-- **
-- Head office query
(
select office_id as officeId,'0' as customerId,display_name as displayName,office_level_id as officeLevelId,'0' as customerLevelId,global_office_num as globalOfficeNumber,'0' as globalCustomerNumber from office where office_level_id = :OFFICE_LEVEL_ID and office_id = :OFFICE_ID)

        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.ProcessAccountingList">
		<return-scalar column="officeLevel" type="int" />
		<return-scalar column="globalOfficeNum" type="string" />
		<return-scalar column="postedDate" type="date" />
		<return-scalar column="voucherDate" type="date" />
		<return-scalar column="voucherType" type="string" />
		<return-scalar column="glDebit" type="string" />
		<return-scalar column="glCredit" type="string" />
		<return-scalar column="amount" type="big_decimal" />

        <![CDATA[

        Select  a.Office_level as officeLevel,a.global_office_num as globalOfficeNum,a.posted_date as postedDate,a.voucherdate
 as voucherDate ,a.vouchertype as voucherType,a.glcode as glDebit,b.glcode as glCredit,a.debit as amount
from
(
Select  fintrxn.debit_credit_flag,fintrxn.account_trxn_id,5 Office_level,o.global_office_num,o.display_name as "branchname",
fintrxn.posted_date,fintrxn.action_date as "voucherdate",fintrxn.fin_action_id,

(CASE fintrxn.fin_action_id
WHEN 1 then /*PRINCIPALPOSTING*/
    (CASE atrxn.account_action_id
        WHEN 1 then 'CR' /*LoanRepayment*/
        WHEN 9 then 'JV' /*Adjustment (undoes LoanRepayment)*/
        WHEN 18 then 'JV' /*LoanReversal (reverses fees & payments parts)*/
        ELSE concat('Unknown Account Action:', atrxn.account_action_id, ' for Finanical Action ', fintrxn.fin_action_id)
    END)
WHEN 2 then /*INTERESTPOSTING*/
    (CASE atrxn.account_action_id
        WHEN 1 then 'CR' /*LoanRepayment*/
        WHEN 9 then 'JV' /*Adjustment (undoes LoanRepayment)*/
        WHEN 18 then 'JV' /*LoanReversal (reverses fees & payments parts)*/
        ELSE concat('Unknown Account Action:', atrxn.account_action_id, ' for Finanical Action ', fintrxn.fin_action_id)
    END)
WHEN 4 then /*MISCFEEPOSTING*/
    (CASE atrxn.account_action_id
        WHEN 1 then 'CR' /*LoanRepayment*/
        WHEN 9 then 'JV' /*Adjustment (undoes LoanRepayment)*/
        WHEN 18 then 'JV' /*LoanReversal (reverses fees & payments parts)*/
        ELSE concat('Unknown Account Action:', atrxn.account_action_id, ' for Finanical Action ', fintrxn.fin_action_id)
    END)
WHEN 6 then /*MISCPENALTYPOSTING*/
    (CASE atrxn.account_action_id
        WHEN 1 then 'CR' /*LoanRepayment*/
        WHEN 9 then 'JV' /*Adjustment (undoes LoanRepayment)*/
        WHEN 12 then 'CR' /*CustomerAccountRepayment*/
        WHEN 18 then 'JV' /*LoanReversal (reverses fees & payments parts)*/
        ELSE concat('Unknown Account Action:', atrxn.account_action_id, ' for Finanical Action ', fintrxn.fin_action_id)
    END)
WHEN 3 then  /*FEEPOSTING*/
    (CASE atrxn.account_action_id
        WHEN 1 then 'CR' /*Fee*/
        WHEN 4 then 'CR' /*Fee*/
        WHEN 9 then 'JV' /* Adjustment (undoes Fee) */
        WHEN 18 then 'JV' /*LoanReversal (reverses fees & payments parts)*/
        WHEN 12 then 'CR' /*Customer Fee*/
        WHEN 13 THEN 'JV' /*CustomerAdjustment*/
        ELSE concat('Unknown Account Action:', atrxn.account_action_id, ' for Finanical Action ', fintrxn.fin_action_id)
    END)
WHEN 7 then  /*DISBURSAL*/
    (CASE atrxn.account_action_id
        WHEN 10 then 'CP' /*Disbursal*/
        WHEN 19 then 'JV' /*DisrbursalAmountReversal (undoes Disbursal part)*/
        ELSE concat('Unknown Account Action:', atrxn.account_action_id, ' for Finanical Action ', fintrxn.fin_action_id)
    END)
WHEN 5 then 'CR' /*PENALTYPOSTING - However, this is not used by mifos*/
WHEN 9 then 'CR' /*MANDATORYDEPOSIT*/
WHEN 10 then 'CR' /*VOLUNTARYDEPOSIT*/
WHEN 16 then 'CR' /*CUSTOMERACCOUNTMISCFEESPOSTING*/
WHEN 11 then 'CP' /*MANDATORYWITHDRAWAL*/
WHEN 12 then 'CP' /*VOLUNTARYWITHDRAWAL*/
WHEN 8 then 'JV' /*ROUNDING*/
WHEN 14 then 'JV' /*SAVINGS_INTERESTPOSTING*/
WHEN 18 then 'JV' /*MANDATORYDEPOSIT_ADJUSTMENT*/
WHEN 19 then 'JV' /*VOLUNTARYDEPOSIT_ADJUSTMENT*/
WHEN 20 then 'JV' /*MANDATORYWITHDRAWAL_ADJUSTMENT*/
WHEN 21 then 'JV' /*VOLUNTARYWITHDRAWAL_ADJUSTMENT*/
WHEN 22 then 'JV' /*WRITEOFF*/
WHEN 23 then 'JV' /*RESCHEDULE*/
ELSE concat('Unknown Financial Action:', fintrxn.fin_action_id)  /*shouldnt ever get this */
END) as "vouchertype",
gl.glcode_value as "glcode", coa.coa_name as "glname",
sum((case fintrxn.debit_credit_flag when 0 then abs(fintrxn.posted_amount) else 0 end )) as "debit",
sum((case fintrxn.debit_credit_flag when 0 then 0 else abs(fintrxn.posted_amount) end )) as "credit"
from financial_trxn fintrxn
inner join gl_code gl on gl.glcode_id = fintrxn.glcode_id
inner join coa on coa.glcode_id = gl.glcode_id
inner join account_trxn atrxn on atrxn.account_trxn_id = fintrxn.account_trxn_id
inner join account a on a.account_id = atrxn.account_id
inner join office o on o.office_id = a.office_id
where fintrxn.posted_date between :LAST_PROCESSING_DATE and :LAST_PROCESSING_DATE
and global_office_num = :GLOBAL_OFFICE_NUMBER
and fintrxn.debit_credit_flag=0


group by fin_action_id,branchname, voucherdate, vouchertype, glcode, glname
order by branchname, voucherdate, vouchertype, glcode, glname ) a,
(
Select  fintrxn.debit_credit_flag,fintrxn.account_trxn_id,5 Office_level,o.global_office_num,o.display_name as "branchname",
fintrxn.posted_date,fintrxn.action_date as "voucherdate",fintrxn.fin_action_id,

(CASE fintrxn.fin_action_id
WHEN 1 then /*PRINCIPALPOSTING*/
    (CASE atrxn.account_action_id
        WHEN 1 then 'CR' /*LoanRepayment*/
        WHEN 9 then 'JV' /*Adjustment (undoes LoanRepayment)*/
        WHEN 18 then 'JV' /*LoanReversal (reverses fees & payments parts)*/
        ELSE concat('Unknown Account Action:', atrxn.account_action_id, ' for Finanical Action ', fintrxn.fin_action_id)
    END)
WHEN 2 then /*INTERESTPOSTING*/
    (CASE atrxn.account_action_id
        WHEN 1 then 'CR' /*LoanRepayment*/
        WHEN 9 then 'JV' /*Adjustment (undoes LoanRepayment)*/
        WHEN 18 then 'JV' /*LoanReversal (reverses fees & payments parts)*/
        ELSE concat('Unknown Account Action:', atrxn.account_action_id, ' for Finanical Action ', fintrxn.fin_action_id)
    END)
WHEN 4 then /*MISCFEEPOSTING*/
    (CASE atrxn.account_action_id
        WHEN 1 then 'CR' /*LoanRepayment*/
        WHEN 9 then 'JV' /*Adjustment (undoes LoanRepayment)*/
        WHEN 18 then 'JV' /*LoanReversal (reverses fees & payments parts)*/
        ELSE concat('Unknown Account Action:', atrxn.account_action_id, ' for Finanical Action ', fintrxn.fin_action_id)
    END)
WHEN 6 then /*MISCPENALTYPOSTING*/
    (CASE atrxn.account_action_id
        WHEN 1 then 'CR' /*LoanRepayment*/
        WHEN 9 then 'JV' /*Adjustment (undoes LoanRepayment)*/
        WHEN 12 then 'CR' /*CustomerAccountRepayment*/
        WHEN 18 then 'JV' /*LoanReversal (reverses fees & payments parts)*/
        ELSE concat('Unknown Account Action:', atrxn.account_action_id, ' for Finanical Action ', fintrxn.fin_action_id)
    END)
WHEN 3 then  /*FEEPOSTING*/
    (CASE atrxn.account_action_id
        WHEN 1 then 'CR' /*Fee*/
        WHEN 4 then 'CR' /*Fee*/
        WHEN 9 then 'JV' /* Adjustment (undoes Fee) */
        WHEN 18 then 'JV' /*LoanReversal (reverses fees & payments parts)*/
        WHEN 12 then 'CR' /*Customer Fee*/
        WHEN 13 THEN 'JV' /*CustomerAdjustment*/
        ELSE concat('Unknown Account Action:', atrxn.account_action_id, ' for Finanical Action ', fintrxn.fin_action_id)
    END)
WHEN 7 then  /*DISBURSAL*/
    (CASE atrxn.account_action_id
        WHEN 10 then 'CP' /*Disbursal*/
        WHEN 19 then 'JV' /*DisrbursalAmountReversal (undoes Disbursal part)*/
        ELSE concat('Unknown Account Action:', atrxn.account_action_id, ' for Finanical Action ', fintrxn.fin_action_id)
    END)
WHEN 5 then 'CR' /*PENALTYPOSTING - However, this is not used by mifos*/
WHEN 9 then 'CR' /*MANDATORYDEPOSIT*/
WHEN 10 then 'CR' /*VOLUNTARYDEPOSIT*/
WHEN 16 then 'CR' /*CUSTOMERACCOUNTMISCFEESPOSTING*/
WHEN 11 then 'CP' /*MANDATORYWITHDRAWAL*/
WHEN 12 then 'CP' /*VOLUNTARYWITHDRAWAL*/
WHEN 8 then 'JV' /*ROUNDING*/
WHEN 14 then 'JV' /*SAVINGS_INTERESTPOSTING*/
WHEN 18 then 'JV' /*MANDATORYDEPOSIT_ADJUSTMENT*/
WHEN 19 then 'JV' /*VOLUNTARYDEPOSIT_ADJUSTMENT*/
WHEN 20 then 'JV' /*MANDATORYWITHDRAWAL_ADJUSTMENT*/
WHEN 21 then 'JV' /*VOLUNTARYWITHDRAWAL_ADJUSTMENT*/
WHEN 22 then 'JV' /*WRITEOFF*/
WHEN 23 then 'JV' /*RESCHEDULE*/
ELSE concat('Unknown Financial Action:', fintrxn.fin_action_id)  /*shouldnt ever get this */
END) as "vouchertype",
gl.glcode_value as "glcode", coa.coa_name as "glname",
sum((case fintrxn.debit_credit_flag when 0 then abs(fintrxn.posted_amount) else 0 end )) as "debit",
sum((case fintrxn.debit_credit_flag when 0 then 0 else abs(fintrxn.posted_amount) end )) as "credit"
from financial_trxn fintrxn
inner join gl_code gl on gl.glcode_id = fintrxn.glcode_id
inner join coa on coa.glcode_id = gl.glcode_id
inner join account_trxn atrxn on atrxn.account_trxn_id = fintrxn.account_trxn_id
inner join account a on a.account_id = atrxn.account_id
inner join office o on o.office_id = a.office_id
where fintrxn.posted_date between :LAST_PROCESSING_DATE and :LAST_PROCESSING_DATE
  and global_office_num = :GLOBAL_OFFICE_NUMBER
  and fintrxn.debit_credit_flag=1


group by fin_action_id,branchname, voucherdate, vouchertype, glcode, glname
order by branchname, voucherdate, vouchertype, glcode, glname ) b
where a.account_trxn_id=b.account_trxn_id

and a.fin_action_id=b.fin_action_id
and a.debit_credit_flag=0
and b.debit_credit_flag=1

         ]]>
	</sql-query>
	<!-- coa mapping -->

	<sql-query name="ChartOfAccountsForMifos.coaBranchAccountHeadGlCodes">
		<return-scalar column="glcode" type="string" />
		<return-scalar column="glname" type="string" />
        <![CDATA[
         Select b.glcode_value as glcode,a.coa_name as glname from coa a,gl_code b where a.glcode_id=b.glcode_id
   and glcode_value not in (Select lookup_name from lookup_value where entity_id in
   (Select entity_id from lookup_entity where entity_name='Cash'));

        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.coa_Branch">

	<return-scalar column="glcode" type="string" />
		<return-scalar column="glname" type="string" />
        <![CDATA[

        select distinct cb.coa_name as glname, gc.glcode_value as glcode from coa_branch cb join gl_code gc on cb.glcode_value = gc.glcode_value where cb.global_office_num=:GLOBAL_OFFICE_NUM

        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.globalOfficeNumWithCoaName">
	<return-scalar column="glcode" type="string" />
	<return-scalar column="glcodeId" type="short" />
		<return-scalar column="glname" type="string" />
        <![CDATA[

    SELECT c.coa_name AS glname, gc.glcode_value as glcode, c.glcode_id AS glcodeId
  FROM coa c
  join gl_code gc ON c.glcode_id = gc.glcode_id
 WHERE c.coa_name NOT IN
          (SELECT DISTINCT c.coa_name
             FROM    coa c
                  JOIN
                     coa_branch cb
                  ON c.coa_name = cb.coa_name
            WHERE cb.global_office_num = :GLOBAL_OFFICE_NUM_WITH_COA_NAME)


        ]]>
	</sql-query>
	<sql-query name="ChartOfAccountsForMifos.coa_Name">
		<return-scalar column="coaName" type="string" />
		<return-scalar column="glcodeValue" type="string" />
        <![CDATA[
        select gll.glcode_value as glcodeValue, c.coa_name as coaName from gl_code gll join coa c on c.glcode_id=gll.glcode_id where c.coa_name=:COA_NAME

        ]]>
	</sql-query>

	<!-- consolidated -->

	<sql-query name="ChartOfAccountsForMifos.ViewConsolidatedTransactions">
		<return-scalar column="transactionNo" type="int" />
		<return-scalar column="transactionDate" type="date" />
		<return-scalar column="transactionType" type="string" />
		<return-scalar column="officeLevel" type="string" />
		<return-scalar column="displayName" type="string" />
		<return-scalar column="mainAccount" type="string" />
		<return-scalar column="amountAction" type="string" />
		<return-scalar column="subAccount" type="string" />
		<return-scalar column="transactionAmount" type="big_decimal" />
		<return-scalar column="narration" type="string" />
		<return-scalar column="transactionID" type="int" />
		<return-scalar column="audit" type="string" />
        <![CDATA[
SELECT m.transaction_master_id AS transactionNo,
       transaction_date AS transactionDate,
       CASE transaction_type
          WHEN 'CP' THEN 'Cash Payment'
          WHEN 'CR' THEN 'Cash Receipt'
          WHEN 'BR' THEN 'Bank Receipt'
          WHEN 'BP' THEN 'Bank Payment'
          WHEN 'JV' THEN 'Journal Voucher'
          ELSE 'unknown'
       END AS transactionType,
       c.officelevel AS officeLevel,
       display_name AS displayName,
       (SELECT coa_name FROM coa a, gl_code b WHERE a.glcode_id = b.glcode_id AND glcode_value = m.main_account) AS mainaccount,
       m.amount_action AS amountaction,
       (SELECT coa_name FROM coa a, gl_code b WHERE a.glcode_id = b.glcode_id AND glcode_value = d.sub_account) AS subaccount,
       d.transaction_amount AS transactionAmount,
       m.transaction_narration AS narration,
       m.stage,
       d.transaction_id AS transactionID,
       m.audit as audit
  FROM acc_glmaster m,acc_gldetail d,
       (SELECT global_cust_num global_num,
               CASE customer_level_id
                  WHEN 2 THEN 'Group'
                  WHEN 3 THEN 'Center'
                  ELSE 'None'
               END AS officelevel,
               display_name
          FROM customer c
        WHERE customer_level_id IN (2, 3)
        UNION ALL
        SELECT global_office_num global_num,
               CASE office_level_id
                  WHEN 1 THEN 'Head Office'
                  WHEN 2 THEN 'Regional Office'
                  WHEN 3 THEN 'Divisional Office'
                  WHEN 4 THEN 'Area Office'
                  WHEN 5 THEN 'Branch Office'
                  ELSE 'None'
               END AS officelevel,
               display_name
          FROM office o) c
 WHERE     m.transaction_master_id = d.transaction_master_id
       AND m.from_office_id = c.global_num
       and m.stage=0 and m.from_office_id=:BRANCH_OFFICE
       ORDER BY m.transaction_master_id
        ]]>
	</sql-query>

	<sql-query name="ChartOfAccountsForMifos.RolesActivityId">
		<return-scalar column="activityid" type="int" />
		<return-scalar column="roleid" type="int" />
        <![CDATA[

                   select rc.activity_id as activityid ,rc.role_id as roleid from roles_activity rc where rc.activity_id=:ACTIVITYID
        ]]>
	</sql-query>


</hibernate-mapping>
